<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Sounding.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Sounding.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @module meteoJS/sounding
 */
import { altitudeISAByPres,
         potentialTempByTempAndPres,
         equiPotentialTempByTempAndDewpointAndPres,
         dewpointByHMRAndPres } from './calc.js';

/**
 * Data for a sounding level.
 * Nomenclature is analogue to the SHARPpy project (sharppy/sharptab/profile.py)
 * Exception for some units:
 * * Windspeed always in m/s
 * * Temperature in Kelvin
 * * Relative humidity unitless
 * 
 * @typedef {Object} meteoJS/sounding~levelData
 * @param {float} pres Pressure level [hPa].
 * @param {float|undefined} [hght] Altitude above sealevel [m].
 * @param {float|undefined} [tmpk] Temperature [K].
 * @param {float|undefined} [dwpk] Dewpoint-temperature [K].
 * @param {float|undefined} [wdir] Wind direction [Â°].
 * @param {float|undefined} [wspd] Absolute windspeed [m/s].
 * @param {float|undefined} [u] Windspeed in U-direction [m/s].
 * @param {float|undefined} [v] Windspeed in V-direction [m/s].
 * @param {float|undefined} [relh] Relative humidity [].
 * @param {float|undefined} [mixr] Mixing ration [g/kg].
 * @param {float|undefined} [theta] Isentropic temperature [K].
 * @param {float|undefined} [thetae] Equivalent isentropic temperature [K].
 * @param {float|undefined} [wetbulb] Wetbulb isentropic temperature [K].
 * @param {float|undefined} [vtmp] Virtual temperature [K].
 */

/**
 * @classdesc
 * Class represents an atmospheric (radio-)sounding.
 * 
 * @constructor
 * @param {meteoJS/sounding~options} [options] Default options.
 */
export default class Sounding {

constructor({ calcMissing = false } = {}) {
  this.options = {
    calcMissing
  };
  this.levels = {};
}

/**
 * Definition of the options while adding data to the sounding object.
 * @typedef {Object} meteoJS/sounding~options
 * @param {boolean} [calcMissing] Calculate missing data in each level.
 */

/**
 * Adds/replaces sounding data.
 * 
 * @param {meteoJS/sounding~levelData[]} levelsData
 *   Array with data at different levels.
 * @param {meteoJS/sounding~options} [options] Options.
 * @returns {meteoJS.sounding} this.
 */
addLevels(levelsData, options) {
  levelsData.forEach(function (levelData) {
    this.addLevel(levelData, options);
  }, this);
  return this;
}

/**
 * Adds/replaces Data for a certain level.
 * 
 * @param {meteoJS/sounding~levelData} levelData Data to add.
 * @param {meteoJS/sounding~options} [options] Options.
 * @returns {meteoJS.sounding} this.
 */
addLevel(levelData, { calcMissing } = {}) {
  calcMissing = calcMissing ? calcMissing : this.options.calcMissing;
  if ('pres' in levelData &amp;&amp;
      levelData.pres !== undefined) {
    if (calcMissing)
      levelData = this.calculateMissingData(levelData);
    this.levels[levelData.pres] = levelData;
  }
  return this;
}

/**
 * Calculates different parameters, if missing.
 * 
 * @param {meteoJS/sounding~levelData} d Data.
 * @returns {meteoJS/sounding~levelData} Adjusted data.
 */
calculateMissingData({ pres, hght,
                       u, v, wdir, wspd,
                       tmpk, dwpk,
                       relh, mixr, theta, thetae, wetbulb, vtmp }) {
  let d = { pres, hght,
            u, v, wdir, wspd,
            tmpk, dwpk,
            relh, mixr, theta, thetae, wetbulb, vtmp }
  
  // Height
  if (d.hght === undefined)
    d.hght = altitudeISAByPres(d.pres);
  
  // Wind
  if (d.u === undefined &amp;&amp;
      d.v === undefined &amp;&amp;
      d.wdir !== undefined &amp;&amp;
      d.wspd !== undefined) {
    d.u = d.wspd * Math.sin(d.wdir / 180 * Math.PI);
    d.v = d.wspd * Math.cos(d.wdir / 180 * Math.PI);
  }
  else if (d.u !== undefined &amp;&amp;
           d.v !== undefined &amp;&amp;
           d.wdir === undefined &amp;&amp;
           d.wspd === undefined) {
    d.wspd = Math.sqrt(Math.pow(d.u, 2) + Math.pow(d.v, 2));
    d.wdir = Math.arctan(d.u/d.v) / Math.PI * 180;
  }
  
  // Humidity
  if (d.tmpk !== undefined &amp;&amp;
      d.dwpk !== undefined) {
    //if (d.relh === undefined)
    //  meteoJS.calc.;
    //if (d.mixr === undefined)
    //  d.mixr = meteoJS.calc;
    if (d.theta === undefined)
      d.theta = potentialTempByTempAndPres(d.tmpk, d.pres);
    if (d.thetae === undefined)
      d.thetae =
        equiPotentialTempByTempAndDewpointAndPres(d.tmpk, d.dwpk, d.pres);
  }
  else if (d.mixr !== undefined) {
    if (d.dwpk === undefined)
      d.dwpk = dewpointByHMRAndPres(d.mixr, d.pres);
  }
  
  return d;
}

/**
 * Removes the Data for a certain level (if existing).
 * 
 * @param {float} pres Remove the data at this Level [hPa].
 * @returns {meteoJS.sounding} this.
 */
removeLevel(pres) {
  if (pres in this.levels)
    delete this.levels[pres];
  return this;
}

/**
 * Get the data for a specific level. Returns the levelData as passed to the
 * constructor or addLevel.
 * 
 * @param {float} pres Level [hPa].
 * @returns {meteoJS/sounding~levelData|undefined}
 *   Data at a level, undefined if no data available.
 */
getData(pres) {
  return (pres in this.levels) ? 
    this.levels[pres] :
    {
      pres: undefined,
      hght: undefined,
      tmpk: undefined,
      dwpk: undefined,
      wdir: undefined,
      wspd: undefined,
      u: undefined,
      v: undefined,
      relh: undefined,
      mixr: undefined,
      theta: undefined,
      thetae: undefined,
      wetbulb: undefined,
      vtmp: undefined
    };
}

/**
 * Get data for all defined levels. Upward sorted.
 * 
 * @returns {meteoJS/sounding~levelData[]} Array of all the data.
 */
getLevels() {
  return Object
    .keys(this.levels)
    .map(function (pres) { return +pres; })
    .sort(function (a,b) { return a-b; });
}

/**
 * Get nearest level [hPa] with data.
 * 
 * @param {float} pres Pressure [hPa].
 * @returns {float|undefined} Level with data or undefined. [hPa]
 */
getNearestLevel(pres) {
  if (Object.keys(this.levels).length &lt; 1)
    return undefined;
  return Object
    .keys(this.levels)
    .sort(function (levelA, levelB) {
      return Math.abs(levelA-pres) - Math.abs(levelB-pres);
    }).shift();
}

}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-meteoJS.html">meteoJS</a></li><li><a href="module-meteoJS_base_collection.html">meteoJS/base/collection</a></li><li><a href="module-meteoJS_base_named.html">meteoJS/base/named</a></li><li><a href="module-meteoJS_base_namedCollection.html">meteoJS/base/namedCollection</a></li><li><a href="module-meteoJS_base_unique.html">meteoJS/base/unique</a></li><li><a href="module-meteoJS_base_uniquenamed.html">meteoJS/base/uniquenamed</a></li><li><a href="module-meteoJS_calc.html">meteoJS/calc</a></li><li><a href="module-meteoJS_events.html">meteoJS/events</a></li><li><a href="module-meteoJS_helpers.html">meteoJS/helpers</a></li><li><a href="module-meteoJS_repetitiveRequests.html">meteoJS/repetitiveRequests</a></li><li><a href="module-meteoJS_sounding.html">meteoJS/sounding</a></li><li><a href="module-meteoJS_synview.html">meteoJS/synview</a></li><li><a href="module-meteoJS_synview_collection.html">meteoJS/synview/collection</a></li><li><a href="module-meteoJS_synview_map.html">meteoJS/synview/map</a></li><li><a href="module-meteoJS_synview_map_ll.html">meteoJS/synview/map/ll</a></li><li><a href="module-meteoJS_synview_map_ol.html">meteoJS/synview/map/ol</a></li><li><a href="module-meteoJS_synview_resource.html">meteoJS/synview/resource</a></li><li><a href="module-meteoJS_synview_resource_GeoJSON.html">meteoJS/synview/resource/GeoJSON</a></li><li><a href="module-meteoJS_synview_resource_GeoJSONTile.html">meteoJS/synview/resource/GeoJSONTile</a></li><li><a href="module-meteoJS_synview_resource_Image.html">meteoJS/synview/resource/Image</a></li><li><a href="module-meteoJS_synview_resource_OSM.html">meteoJS/synview/resource/OSM</a></li><li><a href="module-meteoJS_synview_resource_Vector.html">meteoJS/synview/resource/Vector</a></li><li><a href="module-meteoJS_synview_resource_VectorTile.html">meteoJS/synview/resource/VectorTile</a></li><li><a href="module-meteoJS_synview_resourceCollection.html">meteoJS/synview/resourceCollection</a></li><li><a href="module-meteoJS_synview_tooltip.html">meteoJS/synview/tooltip</a></li><li><a href="module-meteoJS_synview_type.html">meteoJS/synview/type</a></li><li><a href="module-meteoJS_synview_typeCollection.html">meteoJS/synview/typeCollection</a></li><li><a href="module-meteoJS_thermodynamicDiagram.html">meteoJS/thermodynamicDiagram</a></li><li><a href="module-meteoJS_thermodynamicDiagram_axes_axes_axisLabels.html">meteoJS/thermodynamicDiagram/axes/axes/axisLabels</a></li><li><a href="module-meteoJS_thermodynamicDiagram_axes_xAxis.html">meteoJS/thermodynamicDiagram/axes/xAxis</a></li><li><a href="module-meteoJS_thermodynamicDiagram_axes_yAxis.html">meteoJS/thermodynamicDiagram/axes/yAxis</a></li><li><a href="module-meteoJS_thermodynamicDiagram_coordinateSystem.html">meteoJS/thermodynamicDiagram/coordinateSystem</a></li><li><a href="module-meteoJS_thermodynamicDiagram_coordinateSystem_emagram.html">meteoJS/thermodynamicDiagram/coordinateSystem/emagram</a></li><li><a href="module-meteoJS_thermodynamicDiagram_coordinateSystem_skewTlogPDiagram.html">meteoJS/thermodynamicDiagram/coordinateSystem/skewTlogPDiagram</a></li><li><a href="module-meteoJS_thermodynamicDiagram_coordinateSystem_stueveDiagram.html">meteoJS/thermodynamicDiagram/coordinateSystem/stueveDiagram</a></li><li><a href="module-meteoJS_thermodynamicDiagram_hodograph.html">meteoJS/thermodynamicDiagram/hodograph</a></li><li><a href="module-meteoJS_thermodynamicDiagram_sounding.html">meteoJS/thermodynamicDiagram/sounding</a></li><li><a href="module-meteoJS_thermodynamicDiagram_tdDiagram.html">meteoJS/thermodynamicDiagram/tdDiagram</a></li><li><a href="module-meteoJS_thermodynamicDiagram_windprofile.html">meteoJS/thermodynamicDiagram/windprofile</a></li><li><a href="module-meteoJS_timeline.html">meteoJS/timeline</a></li><li><a href="module-meteoJS_timeline_animation.html">meteoJS/timeline/animation</a></li><li><a href="module-meteoJS_timeline_animation_togglebutton.html">meteoJS/timeline/animation/togglebutton</a></li><li><a href="module-meteoJS_timeline_navigationButtons.html">meteoJS/timeline/navigationButtons</a></li><li><a href="module-meteoJS_timeline_visualisation.html">meteoJS/timeline/visualisation</a></li><li><a href="module-meteoJS_timeline_visualisation_bsButtons.html">meteoJS/timeline/visualisation/bsButtons</a></li><li><a href="module-meteoJS_timeline_visualisation_bsDropdown.html">meteoJS/timeline/visualisation/bsDropdown</a></li><li><a href="module-meteoJS_timeline_visualisation_slider.html">meteoJS/timeline/visualisation/slider</a></li><li><a href="module-meteoJS_timeline_visualisation_text.html">meteoJS/timeline/visualisation/text</a></li><li><a href="module-meteoJS_tooltip.html">meteoJS/tooltip</a></li><li><a href="module-meteoJS_tooltip_bootstrapTooltip.html">meteoJS/tooltip/bootstrapTooltip</a></li></ul><h3>Classes</h3><ul><li><a href="module-meteoJS_base_collection.Collection.html">Collection</a></li><li><a href="module-meteoJS_base_named.Named.html">Named</a></li><li><a href="module-meteoJS_base_namedCollection.NamedCollection.html">NamedCollection</a></li><li><a href="module-meteoJS_base_unique.Unique.html">Unique</a></li><li><a href="module-meteoJS_base_uniquenamed.UniqueNamed.html">UniqueNamed</a></li><li><a href="module-meteoJS_repetitiveRequests.RepetitiveRequests.html">RepetitiveRequests</a></li><li><a href="module-meteoJS_sounding.html">meteoJS/sounding</a></li><li><a href="module-meteoJS_synview.html">meteoJS/synview</a></li><li><a href="module-meteoJS_synview_collection.html">meteoJS/synview/collection</a></li><li><a href="module-meteoJS_synview_map.html">meteoJS/synview/map</a></li><li><a href="module-meteoJS_synview_map_ll.html">meteoJS/synview/map/ll</a></li><li><a href="module-meteoJS_synview_map_ol.html">meteoJS/synview/map/ol</a></li><li><a href="module-meteoJS_synview_resource.Resource.html">Resource</a></li><li><a href="module-meteoJS_synview_resource_GeoJSON.GeoJSON.html">GeoJSON</a></li><li><a href="module-meteoJS_synview_resource_GeoJSONTile.GeoJSONTile.html">GeoJSONTile</a></li><li><a href="module-meteoJS_synview_resource_Image.Image.html">Image</a></li><li><a href="module-meteoJS_synview_resource_OSM.OSM.html">OSM</a></li><li><a href="module-meteoJS_synview_resource_Vector.Vector.html">Vector</a></li><li><a href="module-meteoJS_synview_resource_VectorTile.VectorTile.html">VectorTile</a></li><li><a href="module-meteoJS_synview_resourceCollection.html">meteoJS/synview/resourceCollection</a></li><li><a href="module-meteoJS_synview_tooltip.Tooltip.html">Tooltip</a></li><li><a href="module-meteoJS_synview_type.Type.html">Type</a></li><li><a href="module-meteoJS_synview_typeCollection.html">meteoJS/synview/typeCollection</a></li><li><a href="module-meteoJS_thermodynamicDiagram.html">meteoJS/thermodynamicDiagram</a></li><li><a href="module-meteoJS_thermodynamicDiagram_axes_xAxis.html">meteoJS/thermodynamicDiagram/axes/xAxis</a></li><li><a href="module-meteoJS_thermodynamicDiagram_axes_yAxis.html">meteoJS/thermodynamicDiagram/axes/yAxis</a></li><li><a href="module-meteoJS_thermodynamicDiagram_coordinateSystem.html">meteoJS/thermodynamicDiagram/coordinateSystem</a></li><li><a href="module-meteoJS_thermodynamicDiagram_coordinateSystem_emagram.html">meteoJS/thermodynamicDiagram/coordinateSystem/emagram</a></li><li><a href="module-meteoJS_thermodynamicDiagram_coordinateSystem_skewTlogPDiagram.html">meteoJS/thermodynamicDiagram/coordinateSystem/skewTlogPDiagram</a></li><li><a href="module-meteoJS_thermodynamicDiagram_coordinateSystem_stueveDiagram.html">meteoJS/thermodynamicDiagram/coordinateSystem/stueveDiagram</a></li><li><a href="module-meteoJS_thermodynamicDiagram_hodograph.html">meteoJS/thermodynamicDiagram/hodograph</a></li><li><a href="module-meteoJS_thermodynamicDiagram_sounding.html">meteoJS/thermodynamicDiagram/sounding</a></li><li><a href="module-meteoJS_thermodynamicDiagram_tdDiagram.html">meteoJS/thermodynamicDiagram/tdDiagram</a></li><li><a href="module-meteoJS_thermodynamicDiagram_windprofile.html">meteoJS/thermodynamicDiagram/windprofile</a></li><li><a href="module-meteoJS_timeline.Timeline.html">Timeline</a></li><li><a href="module-meteoJS_timeline_animation.Animation.html">Animation</a></li><li><a href="module-meteoJS_timeline_animation_togglebutton.ToggleButton.html">ToggleButton</a></li><li><a href="module-meteoJS_timeline_navigationButtons.NavigationButtons.html">NavigationButtons</a></li><li><a href="module-meteoJS_timeline_visualisation.html">meteoJS/timeline/visualisation</a></li><li><a href="module-meteoJS_timeline_visualisation_bsButtons.html">meteoJS/timeline/visualisation/bsButtons</a></li><li><a href="module-meteoJS_timeline_visualisation_bsDropdown.html">meteoJS/timeline/visualisation/bsDropdown</a></li><li><a href="module-meteoJS_timeline_visualisation_slider.html">meteoJS/timeline/visualisation/slider</a></li><li><a href="module-meteoJS_timeline_visualisation_text.html">meteoJS/timeline/visualisation/text</a></li><li><a href="module-meteoJS_tooltip.Tooltip.html">Tooltip</a></li><li><a href="module-meteoJS_tooltip_bootstrapTooltip.BootstrapTooltip.html">BootstrapTooltip</a></li></ul><h3>Events</h3><ul><li><a href="meteoJS.synview.collection.html#event:add:item">add:item</a></li><li><a href="meteoJS.synview.collection.html#event:remove:item">remove:item</a></li><li><a href="meteoJS.synview.collection.html#event:replace:item">replace:item</a></li><li><a href="meteoJS.synview.map.html#event:change:view">change:view</a></li><li><a href="meteoJS.synview.map.html#event:click:pointer">click:pointer</a></li><li><a href="meteoJS.synview.map.html#event:dblclick:pointer">dblclick:pointer</a></li><li><a href="meteoJS.synview.map.html#event:drag:pointer">drag:pointer</a></li><li><a href="meteoJS.synview.map.html#event:move:pointer">move:pointer</a></li><li><a href="meteoJS.synview.map.html#event:singleclick:pointer">singleclick:pointer</a></li><li><a href="meteoJS.synview.type.html#event:change:resources">change:resources</a></li><li><a href="meteoJS.synview.type.html#event:change:visible">change:visible</a></li><li><a href="meteoJS_base_collection.html#event:add:item">add:item</a></li><li><a href="meteoJS_base_collection.html#event:remove:item">remove:item</a></li><li><a href="meteoJS_base_collection.html#event:replace:item">replace:item</a></li><li><a href="module-meteoJS_repetitiveRequests.html#event:error:request">error:request</a></li><li><a href="module-meteoJS_repetitiveRequests.html#event:success:request">success:request</a></li><li><a href="module-meteoJS_synview_resourceCollection.html#event:add:item">add:item</a></li><li><a href="module-meteoJS_synview_resourceCollection.html#event:remove:item">remove:item</a></li><li><a href="module-meteoJS_synview_resourceCollection.html#event:replace:item">replace:item</a></li><li><a href="module-meteoJS_synview_typeCollection.html#event:add:item">add:item</a></li><li><a href="module-meteoJS_synview_typeCollection.html#event:remove:item">remove:item</a></li><li><a href="module-meteoJS_synview_typeCollection.html#event:replace:item">replace:item</a></li><li><a href="module-meteoJS_timeline.html#event:change:enabledTimes">change:enabledTimes</a></li><li><a href="module-meteoJS_timeline.html#event:change:time">change:time</a></li><li><a href="module-meteoJS_timeline.html#event:change:times">change:times</a></li><li><a href="module-meteoJS_timeline_animation.html#event:change:imageFrequency">change:imageFrequency</a></li><li><a href="module-meteoJS_timeline_animation.html#event:change:restartPause">change:restartPause</a></li><li><a href="module-meteoJS_timeline_animation.html#event:end:animation">end:animation</a></li><li><a href="module-meteoJS_timeline_animation.html#event:restart:animation">restart:animation</a></li><li><a href="module-meteoJS_timeline_animation.html#event:start:animation">start:animation</a></li><li><a href="module-meteoJS_timeline_animation.html#event:stop:animation">stop:animation</a></li><li><a href="module-meteoJS_timeline_navigationButtons.html#event:click:button">click:button</a></li><li><a href="module-meteoJS_tooltip.html#event:hide:tooltip">hide:tooltip</a></li><li><a href="module-meteoJS_tooltip.html#event:show:tooltip">show:tooltip</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Tue Feb 04 2020 16:41:20 GMT+0100 (GMT+01:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
