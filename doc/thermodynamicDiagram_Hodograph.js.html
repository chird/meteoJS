<!doctype html>
<html>

<head>
  <meta name="generator" content="JSDoc 3.6.6">
  <meta charset="utf-8">
  <title>Source: thermodynamicDiagram/Hodograph.js</title>
  <link rel="stylesheet" href="https://brick.a.ssl.fastly.net/Karla:400,400i,700,700i" type="text/css">
  <link rel="stylesheet" href="https://brick.a.ssl.fastly.net/Noto+Serif:400,400i,700,700i" type="text/css">
  <link rel="stylesheet" href="https://brick.a.ssl.fastly.net/Inconsolata:500" type="text/css">
  <link href="css/baseline.css" rel="stylesheet">
</head>

<body onload="prettyPrint()">
  <nav id="jsdoc-navbar" role="navigation" class="jsdoc-navbar">
    <div id="jsdoc-navbar-container">
      <div id="jsdoc-navbar-content">
        <a href="index.html" class="jsdoc-navbar-package-name">Home</a>
      </div>
    </div>
  </nav>
  <div id="jsdoc-body-container">
    <div id="jsdoc-content">
      <div id="jsdoc-content-container">
        <div id="jsdoc-banner" role="banner">
        </div>
        <div id="jsdoc-main" role="main">
          <header class="page-header">
            <h1>Source: thermodynamicDiagram/Hodograph.js</h1>
          </header>
          <article>
            <pre class="prettyprint linenums"><code>/**
 * @module meteoJS/thermodynamicDiagram/hodograph
 */
import { windspeedKMHToMS,
  windspeedKNToMS,
  windspeedMSToKMH } from &#x27;../calc.js&#x27;;
import {
  getNormalizedLineOptions,
  getNormalizedTextOptions
} from &#x27;./Functions.js&#x27;;
import PlotDataArea from &#x27;./PlotDataArea.js&#x27;;

/**
 * Options for the circle grid.
 * 
 * @typedef {module:meteoJS/thermodynamicDiagram~lineStyleOptions}
 *   module:meteoJS/thermodynamicDiagram/hodograph~gridCirclesOptions
 * @param {number} [interval&#x3D;13.89]
 *   Interval between grid circles (and value for the first grid circle).
 *   In m/s.
 */

/**
 * Options for the grid labels.
 * 
 * @typedef {module:meteoJS/thermodynamicDiagram~textOptions}
 *   module:meteoJS/thermodynamicDiagram/hodograph~gridLabelsOptions
 * @param {number} [angle&#x3D;45]
 *   Angle of the labels startin from the origin
 *   (in degrees, 0 relates to North).
 */

/**
 * Options for the constructor.
 * 
 * @typedef {module:meteoJS/thermodynamicDiagram/plotDataArea~options}
 *   module:meteoJS/thermodynamicDiagram/hodograph~options
 * @param {Object} [grid] - Options for the hodograph grid.
 * @param {module:meteoJS/thermodynamicDiagram~lineOptions} [grid.axes]
 *   Options for the hodograph&#x27;s x- and y-axes.
 * @param {module:meteoJS/thermodynamicDiagram/hodograph~gridCirclesOptions}
 *   [grid.circles] - Options for the hodograph circle grid.
 * @param {module:meteoJS/thermodynamicDiagram/hodograph~gridLabelsOptions}
 *   [grid.labels] - Options for the hodograph grid labels.
 * @param {number|undefined} [grid.max&#x3D;undefined]
 *   Maximum value for the grid axes and circles. If undefined, determined from
 *   &#x27;minWindspeedRange&#x27;.
 * @param {number} [windspeedMax&#x3D;41.67]
 *   The maximum windspeed [m/s], that should be visible on the plot. This
 *   refers to the x- or y-direction with the origin in the middle of the plot,
 *   because in these directions, a polar plot has the least extent concerning
 *   distance.
 * @param {number[]|undefined} [origin&#x3D;undefined]
 *   Move origin of polar plot. If &#x27;undefined&#x27; the origin is in the center. To
 *   move, use an array with 2 elements. The first element moves the origin in
 *   x direction, the second in y direction. The values are interpreted as
 *   relative length (relating to the half width resp. height). Positive values
 *   to move in South-West direction. E.g. to move the origin the half way to
 *   South-West, use [0.5, 0.5].
 */

/**
 * Class to draw the hodograph.
 * 
 * &amp;lt;pre&gt;&amp;lt;code&gt;import Hodograph from &#x27;meteojs/thermodynamicDiagram/Hodograph&#x27;;&amp;lt;/code&gt;&amp;lt;/pre&gt;
 * 
 * @extends module:meteoJS/thermodynamicDiagram/plotDataArea.PlotDataArea
 */
export class Hodograph extends PlotDataArea {
  
  /**
   * @param {module:meteoJS/thermodynamicDiagram/hodograph~options} options
   *   Options.
   */
  constructor({
    svgNode &#x3D; undefined,
    coordinateSystem,
    x,
    y,
    width,
    height,
    style &#x3D; {},
    visible &#x3D; true,
    events &#x3D; {},
    dataGroupIds &#x3D; [&#x27;windbarbs&#x27;],
    getCoordinatesByLevelData &#x3D; (dataGroupId, sounding, levelData, plotArea) &#x3D;&gt; {
      if (levelData.wspd &#x3D;&#x3D;&#x3D; undefined ||
          levelData.wdir &#x3D;&#x3D;&#x3D; undefined)
        return {};
      
      const x &#x3D; levelData.wspd * -Math.sin(levelData.wdir / 180 * Math.PI);
      const y &#x3D; levelData.wspd * Math.cos(levelData.wdir / 180 * Math.PI);
      return {
        x: plotArea.center[0] + x * plotArea.pixelPerSpeed,
        y: plotArea.center[1] + y * plotArea.pixelPerSpeed
      };
    },
    insertDataGroupInto &#x3D; (svgNode, dataGroupId, sounding, data) &#x3D;&gt; {
      svgNode
        .polyline(data.map(level &#x3D;&gt; [ level.x, level.y ]))
        .fill(&#x27;none&#x27;).stroke(sounding.options.hodograph.style);
    },
    grid &#x3D; {},
    windspeedMax &#x3D; windspeedKNToMS(150),
    origin &#x3D; undefined,
    filterDataPoint &#x3D; undefined,
    minDataPointsDistance &#x3D; 0
  }) {
    super({
      svgNode,
      coordinateSystem,
      x,
      y,
      width,
      height,
      style,
      visible,
      events,
      dataGroupIds,
      getCoordinatesByLevelData,
      insertDataGroupInto,
      getSoundingVisibility:
        sounding &#x3D;&gt; sounding.visible &amp;amp;&amp;amp; sounding.options.hodograph.visible,
      filterDataPoint,
      minDataPointsDistance
    });
    
    this._gridOptions &#x3D; this.getNormalizedGridOptions(grid);
    
    this.center &#x3D; [this.width/2, this.height/2];
    if (origin !&#x3D;&#x3D; undefined) {
      this.center[0] -&#x3D; origin[0] * this.minLength/2;
      this.center[1] +&#x3D; origin[1] * this.minLength/2;
    }
    this.pixelPerSpeed &#x3D; Math.min(
      Math.max(this.width - this.center[0], this.center[0]),
      Math.max(this.height - this.center[1], this.center[1])
    ) / windspeedMax;
    if (this._gridOptions.max &#x3D;&#x3D;&#x3D; undefined)
      this._gridOptions.max &#x3D; windspeedMax;
    
    this.init();
  }
  
  /**
   * Plots hodograph background.
   * 
   * @override
   */
  _drawBackground(svgNode) {
    super._drawBackground(svgNode);
    
    // border, background
    svgNode
      .rect(this.width-2, this.height-2)
      .move(1,1)
      .fill({color: &#x27;white&#x27;})
      .stroke({color: &#x27;black&#x27;, width: 1});
    //.attr({rx: 10, ry: 10});
    
    // x-/y-axes
    if (this._gridOptions.axes.visible) {
      let axesLength &#x3D;
        this._gridOptions.max + this._gridOptions.circles.interval / 2;
      svgNode
        .line(
          Math.max(0, this.center[0] - axesLength * this.pixelPerSpeed),
          this.center[1],
          Math.min(this.width,
            this.center[0] + axesLength * this.pixelPerSpeed),
          this.center[1]
        )
        .stroke(this._gridOptions.axes.style);
      svgNode
        .line(
          this.center[0],
          Math.max(0, this.center[1] - axesLength * this.pixelPerSpeed),
          this.center[0],
          Math.min(this.height,
            this.center[1] + axesLength * this.pixelPerSpeed)
        )
        .stroke(this._gridOptions.axes.style);
    }
    
    // circles and labels
    for (let v &#x3D; this._gridOptions.circles.interval;
      v &amp;lt;&#x3D; this._gridOptions.max;
      v +&#x3D; this._gridOptions.circles.interval) {
      let radius &#x3D; v * this.pixelPerSpeed;
      svgNode
        .circle(2*radius)
        .attr({
          cx: this.center[0],
          cy: this.center[1]
        })
        .fill(&#x27;none&#x27;)
        .stroke(this._gridOptions.circles.style);
      if (this._gridOptions.labels.visible) {
        let xText &#x3D;
          radius *
          Math.cos((this._gridOptions.labels.angle - 90) / 180 * Math.PI);
        let yText &#x3D;
          radius *
          Math.sin((this._gridOptions.labels.angle - 90) / 180 * Math.PI);
        let textAnchor &#x3D; &#x27;middle&#x27;;
        let dx &#x3D; 0;
        let dy &#x3D; -this._gridOptions.labels.font.size;
        if (this._gridOptions.labels.angle &#x3D;&#x3D; 0 ||
          this._gridOptions.labels.angle &#x3D;&#x3D; 180) {
          dx &#x3D; -3;
          textAnchor &#x3D; &#x27;end&#x27;;
        }
        else if (this._gridOptions.labels.angle &#x3D;&#x3D; 90 ||
               this._gridOptions.labels.angle &#x3D;&#x3D; 270)
          dy &#x3D; -3;
        let text &#x3D; svgNode
          .plain(&#x27;&#x27; + Math.round(windspeedMSToKMH(v)))
          .move(this.center[0] + xText, this.center[1] + yText)
          .attr({
            &#x27;text-anchor&#x27;: textAnchor,
            //&#x27;alignment-baseline&#x27;: &#x27;middle&#x27;
            dx: dx,
            dy: dy // XXX: Hack f√ºr Firefox
          })
          .font(this._gridOptions.labels.font);
        let bbox &#x3D; text.bbox();
        text.before(
          svgNode
            .rect(bbox.width, bbox.height)
            .move(bbox.x, bbox.y)
            .fill(&#x27;white&#x27;)
        );
      }
    }
  }
  
  /**
   * Normalizes options for grid.
   * 
   * @private
   */
  getNormalizedGridOptions({
    axes &#x3D; {},
    circles &#x3D; {},
    labels &#x3D; {},
    max &#x3D; undefined
  }) {
    axes &#x3D; getNormalizedLineOptions(axes);
    circles &#x3D; getNormalizedLineOptions(circles);
    if (!(&#x27;interval&#x27; in circles) ||
        circles.interval &#x3D;&#x3D;&#x3D; undefined)
      circles.interval &#x3D; windspeedKMHToMS(50);
    labels &#x3D; getNormalizedTextOptions(labels);
    if (!(&#x27;angle&#x27; in labels) ||
        labels.angle &#x3D;&#x3D;&#x3D; undefined)
      labels.angle &#x3D; 225;
    if (labels.font.size &#x3D;&#x3D;&#x3D; undefined)
      labels.font.size &#x3D; 10;
    
    return {
      axes,
      circles,
      labels,
      max
    };
  }
}
export default Hodograph;</code></pre>
          </article>
        </div>
      </div>
      <nav id="jsdoc-toc-nav" role="navigation"></nav>
    </div>
  </div>
  <footer id="jsdoc-footer" class="jsdoc-footer">
    <div id="jsdoc-footer-container">
      <p>
        Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc</a> 3.6.6 on March 23, 2021.
      </p>
    </div>
  </footer>
  <script src="scripts/jquery.min.js"></script>
  <script src="scripts/tree.jquery.js"></script>
  <script src="scripts/prettify.js"></script>
  <script src="scripts/jsdoc-toc.js"></script>
  <script src="scripts/linenumber.js"></script>
  <script src="scripts/scrollanchor.js"></script>
</body>

</html>