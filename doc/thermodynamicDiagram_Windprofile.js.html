<!doctype html>
<html>

<head>
  <meta name="generator" content="JSDoc 3.6.3">
  <meta charset="utf-8">
  <title>Source: thermodynamicDiagram/Windprofile.js</title>
  <link rel="stylesheet" href="https://brick.a.ssl.fastly.net/Karla:400,400i,700,700i" type="text/css">
  <link rel="stylesheet" href="https://brick.a.ssl.fastly.net/Noto+Serif:400,400i,700,700i" type="text/css">
  <link rel="stylesheet" href="https://brick.a.ssl.fastly.net/Inconsolata:500" type="text/css">
  <link href="css/baseline.css" rel="stylesheet">
</head>

<body onload="prettyPrint()">
  <nav id="jsdoc-navbar" role="navigation" class="jsdoc-navbar">
    <div id="jsdoc-navbar-container">
      <div id="jsdoc-navbar-content">
        <a href="index.html" class="jsdoc-navbar-package-name">Home</a>
      </div>
    </div>
  </nav>
  <div id="jsdoc-body-container">
    <div id="jsdoc-content">
      <div id="jsdoc-content-container">
        <div id="jsdoc-banner" role="banner">
        </div>
        <div id="jsdoc-main" role="main">
          <header class="page-header">
            <h1>Source: thermodynamicDiagram/Windprofile.js</h1>
          </header>
          <article>
            <pre class="prettyprint linenums"><code>/**
 * @module meteoJS/thermodynamicDiagram/windprofile
 */
import $ from &#x27;jquery&#x27;;
import { windspeedMSToKN } from &#x27;../calc.js&#x27;;

/**
 * Definition of the options for the constructor.
 * @typedef {Object} module:meteoJS/thermodynamicDiagram/windprofile~options
 * @param {boolean} visible Visibility of the windprofile container.
 * @param {undefined|integer} x Horizontal position of the windprofile container.
 * @param {undefined|integer} y Vertical position of the windprofile container.
 * @param {undefined|integer} width Width of the windprofile container.
 * @param {undefined|integer} height Height of the windprofile container.
 * @param {Object} windbarbs Windbarbs on the right side of the diagram.
 * @param {boolean} windbarbs.visible
 * @param {undefined|integer} windbarbs.width
 *   Width of container for windbarbs
 *   (if undefined, 1/3 of total width of the windprofile container)
 * @param {undefined|integer} windbarbs.barbsLength
 *   Length of the individual windbarbs.
 *   (if undefined, 40% of width of the windbarbs container)
 * @param {Object} windspeed Windspeed with height on the right side of the diagram.
 * @param {boolean} windspeed.visible
 * @param {undefined|integer} windspeed.width
 *   Width of container for windspeed profile
 *   (if undefined, 2/3 of total width of the windprofile container)
 */

/**
 * Class to draw the windprofiles (windbarbs and windspeed).
 * Called by meteoJS.thermodynamicDiagram.
 * 
 * Preconditions for options:
 * * x, y, width, height mustn&#x27;t be undefined.
 */
export class Windprofile {
  
  /**
   * @param {external:SVG} svgNode - SVG-Node to render profiles into.
   * @param {module:meteoJS/thermodynamicDiagram/windprofile~options} options
   *   Windprofile options.
   */
  constructor(main, options) {
    this.options &#x3D; $.extend(true, {
      visible: true,
      x: undefined,
      y: undefined,
      width: undefined,
      height: undefined,
      windbarbs: {
        visible: true,
        width: undefined,
        barbsLength: undefined
      },
      windspeed: {
        visible: true,
        width: undefined
      }
    }, options);
  
    this.main &#x3D; main;
    this.cos &#x3D; main.getCoordinateSystem();
  
    // Optionen finalisieren
    if (!this.options.windbarbs.visible)
      this.options.windbarbs.width &#x3D; 0;
    if (!this.options.windspeed.visible)
      this.options.windspeed.width &#x3D; 0;
    if (this.options.windbarbs.width &#x3D;&#x3D;&#x3D; undefined &amp;amp;&amp;amp;
      this.options.windspeed.width &#x3D;&#x3D;&#x3D; undefined) {
      this.options.windbarbs.width &#x3D; this.options.width/3;
      this.options.windspeed.width &#x3D;
      this.options.width-this.options.windbarbs.width;
    }
    else if (this.options.windbarbs.width &#x3D;&#x3D;&#x3D; undefined)
      this.options.windbarbs.width &#x3D; 
      this.options.width-this.options.windspeed.width;
    else
      this.options.windspeed.width &#x3D; 
      this.options.width-this.options.windbarbs.width;
    if (this.options.windbarbs.barbsLength &#x3D;&#x3D;&#x3D; undefined)
      this.options.windbarbs.barbsLength &#x3D; this.options.windbarbs.width * 2/5;
  
    // Nested svg-Nodes erstellen
    this.svgNode &#x3D; main.getSVGNode().nested()
      .attr({
        x: this.options.x,
        y: this.options.y,
        width: this.options.width,
        height: this.options.height
      })
      .style({ overflow: &#x27;hidden&#x27; });
    this.nodeWindbarbs &#x3D; this.svgNode.nested()
      .attr({
        x: 0,
        y: 0,
        width: this.options.windbarbs.width,
        height: this.options.height
      });
    this.soundingsWindbarbsGroup &#x3D; this.nodeWindbarbs.group();
    if (!this.options.windbarbs.visible)
      this.nodeWindbarbs.hide();
    this.nodeWindspeed &#x3D; this.svgNode.nested()
      .attr({
        x: this.options.windbarbs.width,
        y: 0,
        width: this.options.windspeed.width,
        height: this.options.height
      });
    if (!this.options.windspeed.visible)
      this.nodeWindspeed.hide();
  
    this.plotWindspeeds();
  }

  /**
 * Plots windspeed profile 
 * 
 * @internal
 */
  plotWindspeeds() {
    this.nodeWindspeed.clear();
    if (this.options.windspeed.visible) {
      this.nodeWindspeed
        .line(0, 0,
          0, this.options.height)
        .stroke({width: 1});
      this.nodeWindspeed
        .line(this.options.windspeed.width, 0,
          this.options.windspeed.width, this.options.height)
        .stroke({width: 1});
    }
    this.soundingsWindspeedGroup &#x3D; this.nodeWindspeed.group();
  }

  /**
 * Adds Sounding to windprofile.
 * 
 * @internal
 * @param {module:meteoJS/thermodynamicDiagram/sounding.DiagramSounding} sounding Sounding object.
 */
  addSounding(sounding) {
    sounding.on(&#x27;change:visible&#x27;, function () {
      this.drawSoundings();
    }, this);
    this.drawSoundings();
  }
  
  /**
   * @private
   */
  drawSoundings() {
    this.soundingsWindbarbsGroup.clear();
    this.soundingsWindspeedGroup.clear();
    this.main.soundings.forEach(function (sounding) {
      if (!sounding.visible() ||
        !sounding.options.windprofile.visible)
        return;
      var windbarbsData &#x3D; [];
      var windspeedPolylines &#x3D; [];
      sounding.getSounding().getLevels().forEach(function (level) {
        var data &#x3D; sounding.getSounding().getData(level);
        if (data.wspd &#x3D;&#x3D;&#x3D; undefined ||
        data.wdir &#x3D;&#x3D;&#x3D; undefined)
          return;
        var y &#x3D; this.options.height - this.cos.getYByXP(0, level);
        // Winddaten f√ºr Barbs
        windbarbsData.push([y, windspeedMSToKN(data.wspd), data.wdir]);
        // Windspeed
        if (windspeedPolylines.length &#x3D;&#x3D; 0)
          windspeedPolylines.push([]);
        windspeedPolylines[windspeedPolylines.length-1].push([
          windspeedMSToKN(this.options.windspeed.width*data.wspd)/150,
          y
        ]);
      }, this);
  
      // Windpfeile zeichnen
      windbarbsData.forEach(function (data) {
        // Windpfeil zeichnen
        var groupArrow &#x3D; this.soundingsWindbarbsGroup.group();
        var xMiddle &#x3D; this.options.windbarbs.width/2;
        var yAddons &#x3D; data[0] - this.options.windbarbs.barbsLength;
        var widthAddons &#x3D; this.options.windbarbs.barbsLength/4;
        groupArrow.line(xMiddle, yAddons, xMiddle, data[0]).stroke(sounding.options.windprofile.windbarbs.style);
        var windspeed &#x3D; data[1];
        while (windspeed &gt;&#x3D; 50) {
          groupArrow.polyline([[xMiddle, yAddons], [xMiddle+widthAddons*2, yAddons+widthAddons*0.8/2], [xMiddle, yAddons+widthAddons*0.8]]).fill(&#x27;none&#x27;).stroke(sounding.options.windprofile.windbarbs.style);
          yAddons +&#x3D; widthAddons;
          windspeed -&#x3D; 50;
        }
        while (windspeed &gt;&#x3D; 10) {
          groupArrow.line(xMiddle, yAddons+widthAddons/2, xMiddle+widthAddons*2, yAddons).stroke(sounding.options.windprofile.windbarbs.style);
          yAddons +&#x3D; widthAddons/2;
          windspeed -&#x3D; 10;
        }
        if (windspeed &gt;&#x3D; 5)
          groupArrow.line(xMiddle, yAddons+widthAddons/2, xMiddle+widthAddons, yAddons+widthAddons/4).stroke(sounding.options.windprofile.windbarbs.style);
        // Drehen
        groupArrow.transform({rotation: data[2], cx: xMiddle, cy: data[0]});
      }, this);
  
      // Windgeschwindigkeit zeichnen
      windspeedPolylines.forEach(function (polyline) {
        this.soundingsWindspeedGroup.polyline(polyline).fill(&#x27;none&#x27;).stroke(sounding.options.windprofile.windspeed.style);
      }, this);
    }, this);
  }

}
export default Windprofile;</code></pre>
          </article>
        </div>
      </div>
      <nav id="jsdoc-toc-nav" role="navigation"></nav>
    </div>
  </div>
  <footer id="jsdoc-footer" class="jsdoc-footer">
    <div id="jsdoc-footer-container">
      <p>
        Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc</a> 3.6.3 on February 10, 2020.
      </p>
    </div>
  </footer>
  <script src="scripts/jquery.min.js"></script>
  <script src="scripts/tree.jquery.js"></script>
  <script src="scripts/prettify.js"></script>
  <script src="scripts/jsdoc-toc.js"></script>
  <script src="scripts/linenumber.js"></script>
  <script src="scripts/scrollanchor.js"></script>
</body>

</html>