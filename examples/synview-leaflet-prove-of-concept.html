<html>
  <head>
    <title>Synview example: Prove of concept to use with Leaflet</title>
    <meta charset="UTF-8">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
    <link rel="stylesheet" href="https://openlayers.org/en/v4.6.5/css/ol.css" type="text/css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css"
      integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin=""/>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script> <!-- requirement for tooltips //-->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
    <script src="https://openlayers.org/en/v4.6.5/build/ol.js"></script>
    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"
      integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA=="
      crossorigin=""></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.1/moment.min.js" integrity="sha256-L3S3EDEk31HcLA5C6T2ovHvOcD80+fgqaCDt2BAi92o=" crossorigin="anonymous"></script>
    <script src="../meteoJS.min.js" type="text/javascript"></script>
  </head>
  <body>
    <div class="container"">
      <div class="row mb-3">
        <div class="col-12">
          <h1>Synview example: Usage of Leaflet, prove of concept</h1>
          <p class="text-muted">In our company, we use
          <a href="http://openlayers.org/" target="_blank">OpenLayers</a>. But
          the synview software is designed to support other libraries for maps.
          Here we present an example of a simple use case with
          <a href="https://leafletjs.com/" target="_blank">Leaflet</a>. However,
          the full support have to be implemented yet and
          so far isn't planned.</p>
        </div>
      </div>
      <div class="row mb-3">
        <div class="col-12 d-flex">
          <div class="mr-4">
            <button type="button" class="btn btn-primary play"></button>
          </div>
          <div class="align-self-center flex-grow-1">
            <input type="range" class="custom-range"></input>
          </div>
          <div class="ml-4 align-self-center">
            <p class="text"></p>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-6">
          <h3>OpenLayers</h3>
          <div class="map" style="height: 350px">
          </div>
        </div>
        <div class="col-6">
          <h3>Leaflet</h3>
          <div class="mapLL" id="mapLL" style="height: 350px">
          </div>
        </div>
      </div>
    </div>
  </body>
  <script type="text/javascript">
$(document).ready(function () {
  var timeline = new meteoJS.timeline();
  var animation = new meteoJS.timeline.animation({
    timeline: timeline
  });
  animation.start();
  new meteoJS.timeline.animation.button({
    animation: animation,
    node: $('button.play')
  });
  new meteoJS.timeline.visualisation.text({
    timeline: timeline,
    node: $('p.text'),
    format: 'HH:mm, ddd, DD. MMM YYYY [UTC]'
  });
  new meteoJS.timeline.visualisation.slider({
    timeline: timeline,
    node: $('input[type=range]'),
    animation: animation // this stops animation on user interaction on slider
  });
  var map = new ol.Map({
    target: $('div.map').get().shift(),
    view: new ol.View({
      center: ol.proj.fromLonLat([8.5, 46.8]),
      zoom: 7
    })
  });
  var mapLL = L.map('mapLL').setView([46.8, 8.5], 7);
  var synview = new meteoJS.synview({
    map: new meteoJS.synview.map.ol({
      map: map
    }),
    timeline: timeline
  });
  var synviewLL = new meteoJS.synview({
    map: new meteoJS.synview.map.ll({
      map: mapLL
    }),
    timeline: timeline
  });
  synview.appendType(new meteoJS.synview.type({
    resources: [new meteoJS.synview.resource.OSM({
      url: "https://maps.tilehosting.com/styles/basic/{z}/{x}/{y}.png?key=Els4NwvjjarAG3Hha6Mw",
      ol: {
        source: {
          attributions: [
            '<a href="https://www.maptiler.com/license/maps/" target="_blank">© MapTiler</a>',
            '<a href="https://www.openstreetmap.org/copyright" target="_blank">© OpenStreetMap contributors</a>'
          ]
        }
      }
    })]
  }));
  L.tileLayer("https://maps.tilehosting.com/styles/basic/{z}/{x}/{y}.png?key=Els4NwvjjarAG3Hha6Mw", {
    attribution: '<a href="https://www.maptiler.com/license/maps/" target="_blank">© MapTiler</a>, <a href="https://www.openstreetmap.org/copyright" target="_blank">© OpenStreetMap contributors</a>'
  }).addTo(mapLL);
  var startDate = new Date(Date.UTC(2018, 6, 20, 13));
  var radarResources = [];
  var radarResourcesLL = [];
  for (var i=0; i<=180; i+=5) {
    var datetime = new Date(startDate.valueOf() + i*60*1000);
    var month = 1+datetime.getUTCMonth();
    if (month.toString().length < 2)
      month = '0' + month;
    var day = datetime.getUTCDate();
    if (day.toString().length < 2)
      day = '0' + day;
    var hours = datetime.getUTCHours() + 2; // Images in 'Europe/Zurich'
    if (hours.toString().length < 2)
      hours = '0' + hours;
    var min = datetime.getUTCMinutes();
    if (min.toString().length < 2)
      min = '0' + min;
    var url = 'img/radar/PPIMERCATOR.' +
      datetime.getUTCFullYear() +
      month + day + hours + min +
      '00.png';
    radarResources.push(new meteoJS.synview.resource.GeoImage({
      url: url,
      datetime: datetime,
      extent: [
        2.61782890779814,
        43.5776333348397,
        13.5838157381454,
        50.1552447279808
      ],
      mimetype: 'image/png',
      ol: {
        source: {
          attributions: [
            '© Bundesamt für Meteorologie und Klimatologie',
            '© <a href="https://www.srf.ch/meteo/radar" target="_blank">SRF Meteo</a>'
          ]
        }
      }
    }));
    radarResourcesLL.push(new meteoJS.synview.resource.GeoImage({
      url: url,
      datetime: datetime,
      extent: [
        2.61782890779814,
        43.5776333348397,
        13.5838157381454,
        50.1552447279808
      ],
      mimetype: 'image/png'
    }));
  }
  var type = new meteoJS.synview.type({
    resources: radarResources,
    tooltip: function (event) {
      if (event.color) {
        var text = '&nbsp;';
        switch (event.color.slice(0,3).join(',')) {
          case '1,183,255': text = 'bis zu 1 mm/h'; break;
          case '1,114,255': text = 'mehr als 1 mm/h'; break;
          case '0,0,200': text = 'mehr als 3 mm/h'; break;
          case '0,0,125': text = 'mehr als 10 mm/h'; break;
          case '255,255,0': text = 'mehr als 30 mm/h'; break;
          case '255,0,0': text = 'mehr als 100 mm/h'; break;
        }
        return '<span style="background-color: rgba(' +
               event.color.join(', ') + ');">' + text + '</span>';
      }
    }
  });
  synview.appendType(type);
  type.replaceResources(radarResources);
  var typeLL = new meteoJS.synview.type();
  synviewLL.appendType(typeLL);
  typeLL.replaceResources(radarResourcesLL);
});
  </script>
</html>