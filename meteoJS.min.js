/**
 * meteoJS. See https://github.com/chird/meteoJS
 * Version: 2018-06-11
 * 
 * Copyright 2018 SRF Meteo
 * License: https://raw.githubusercontent.com/chird/meteoJS/master/LICENSE
 */1;var meteoJS=meteoJS?meteoJS:{};meteoJS.calc=meteoJS.calc?meteoJS.calc:{},meteoJS.calc.altitudeISAByPres=function(e){return e===undefined||isNaN(e)?undefined:44330.769*(1-Math.pow(e/1013.25,.19029496))},meteoJS.calc.pressureISAByAltitude=function(e){return e===undefined||isNaN(e)?undefined:1013.25*Math.pow(1-e/44330.769,5.255)},meteoJS.calc.potentialTempByTempAndPres=function(e,t){return e===undefined||isNaN(e)||t===undefined||isNaN(t)?undefined:e*Math.pow(1e3/t,.286)},meteoJS.calc.tempByPotentialTempAndPres=function(e,t){return e===undefined||isNaN(e)||t===undefined||isNaN(t)?undefined:e*Math.pow(t/1e3,.286)},meteoJS.calc.tempByEquiPotTempAndPres=function(e,t){if(t===undefined||isNaN(t))return undefined;var n=undefined,r=undefined,i=Math.pow(1e3/t,.286),s=273,o=20,u=0;while(Math.abs(o)>.1&&u<100)u++,n=meteoJS.calc.saturationHMRByTempAndPres(s,t),r=s*i*Math.exp(2.5*n/s),(r-e)*o>0&&(o=-0.5*o),s+=o;return s},meteoJS.calc.dewpointByHMRAndPres=function(e,t){if(e===undefined||isNaN(e)||t===undefined||isNaN(t))return undefined;var n=.4343*Math.log(e*t/(622+e));return Math.pow(10,.0498646455*n+2.4082965)-7.07475+38.9114*Math.pow(Math.pow(10,.0915*n)-1.2035,2)},meteoJS.calc.wetbulbTempByTempAndDewpointAndPres=function(e,t,n){if(e===undefined||isNaN(e)||t===undefined||isNaN(t)||n===undefined||isNaN(n))return undefined;var r=t-273.15,i=1,s=10,o=1,u=6.112*Math.exp(17.67*r/(r+243.5));while(Math.abs(i)>.05){var a=6.112*Math.exp(17.67*r/(r+243.5))-n*(e-273.15-r)*66e-5*(1+.00115*r);i=u-a;if(i==0)break;i<0?-1!=o&&(o=-1,s/=10):1!=o&&(o=1,s/=10);if(Math.abs(i)<=.05)break;r+=s*o}return r+273.15},meteoJS.calc.equiPotentialTempByTempAndDewpointAndPres=function(e,t,n){var r=meteoJS.calc.potentialTempByTempAndPres(e,n);return r===undefined||t===undefined||isNaN(t)||e===undefined||isNaN(e)||n===undefined||isNaN(n)?undefined:r*Math.exp(2.4819*meteoJS.calc.saturationHMRByTempAndPres(t,n)/meteoJS.calc.lclTemperatureByTempAndDewpoint(e,t))},meteoJS.calc.saturationPressureByTemp=function(e){if(e===undefined||isNaN(e))return undefined;var t=new Array(6.1104546,.4442351,.014302099,.00026454708,30357098e-13,2.0972268e-8,6.0487594e-11,-1.469687e-13),n=0,r=new Array(.06485546857696639,.03783195122560735,.02224449342887902,.013182892842468312,.007874020771412448,.004739730494884733,.0028751203550435793,.001757430376758103,.0010824173951885098,.0006717089391856059,.0004199647026320394,.0002645243638634699,.00016784796373681322,.00010728539763162038,6907426344961356e-20,4479404897680843e-20,2925704195639373e-20,19245291263499416e-21,12749137241074795e-21,8505070102755051e-21,5713400253349711e-21,3864650296738762e-21,2632109719650053e-21,18049107293057043e-22,12460785055581605e-22,8.660705713468708e-7,6.059822176688955e-7,4.2682119794324277e-7,3.026165085143795e-7,2.15963854234914e-7,1.5512895457833687e-7);e-=273.15;var i=0;if(e>-50)i=t[0]+e*(t[1]+e*(t[2]+e*(t[3]+e*(t[4]+e*(t[5]+e*(t[6]+e*t[7]))))));else{var s=(-e-50)/5;n<r.length-1?i=r[n]+s%1*(r[n+1]-r[n]):i=1e-7}return i},meteoJS.calc.saturationHMRByTempAndPres=function(e,t){var n=meteoJS.calc.saturationPressureByTemp(e);return n===undefined||t===undefined||isNaN(t)?undefined:621.97*n/(t-n)},meteoJS.calc.lclByPotentialTempAndHMR=function(e,t){if(t===undefined||isNaN(t))return undefined;var n=1013,r=100;while(n-r>10){var i=r+(n-r)/2,s=meteoJS.calc.saturationHMRByTempAndPres(meteoJS.calc.tempByPotentialTempAndPres(e,i),i);if(s===undefined)return undefined;s<t?r=i:n=i}return r+(n-r)/2},meteoJS.calc.potentialTempByLCLAndHMR=function(e,t){if(e===undefined||isNaN(e))return undefined;var n=323,r=223;while(n-r>.1){var i=r+(n-r)/2,s=meteoJS.calc.lclByPotentialTempAndHMR(i,t);if(s===undefined)return undefined;s>e?r=i:n=i}return r+(n-r)/2},meteoJS.calc.lclTemperatureByTempAndDewpoint=function(e,t){return e===undefined||isNaN(e)||t===undefined||isNaN(t)?undefined:t-(.001296*t-.15772)*(e-t)},meteoJS.calc.tempCelsiusToKelvin=function(e){return e===undefined||isNaN(e)?undefined:e+273.15},meteoJS.calc.tempKelvinToCelsius=function(e){return e===undefined||isNaN(e)?undefined:e-273.15},meteoJS.calc.windspeedMSToKMH=function(e){return e===undefined||isNaN(e)?undefined:e*3.6},meteoJS.calc.windspeedKMHToMS=function(e){return e===undefined||isNaN(e)?undefined:e/3.6},meteoJS.calc.windspeedMSToKN=function(e){return e===undefined||isNaN(e)?undefined:e*900/463},meteoJS.calc.windspeedKNToMS=function(e){return e===undefined||isNaN(e)?undefined:e*463/900},meteoJS.calc.windspeedMSToBF=function(e){return e===undefined||isNaN(e)?undefined:Math.min(12,Math.pow(e/.836,2/3))},meteoJS.calc.windspeedBFToMS=function(e){return e===undefined||isNaN(e)?undefined:.836*Math.pow(e,1.5)},meteoJS.calc.snowlineByTemp850hPaAndAltidude=function(e,t){return e===undefined||isNaN(e)||t===undefined||isNaN(t)?undefined:153*meteoJS.calc.tempKelvinToCelsius(e)+.9985*t-304.26},meteoJS.calc.pressureByBarometricFormula=function(e,t,n,r){if(e===undefined||isNaN(e)||t===undefined||isNaN(t)||n===undefined||isNaN(n))return undefined;if(t==0)return e;var i=.02896,s=9.807,o=8.314;r===undefined&&(r=n);if(n==r)return e*Math.exp(-i*s/o/n*t);var u=(n-r)/t;return e*Math.exp(i*s/o/u*Math.log(1-u*t/n))},meteoJS.calc.densityHumidAirByPressureAndTempAndRelHumidity=function(e,t,n){if(e===undefined||isNaN(e)||t===undefined||isNaN(t)||n===undefined||isNaN(n))return undefined;var r=287.058,i=461.495,s=meteoJS.calc.saturationPressureByTemp(t)*n;return(e-s)*100/r/t+s*100/i/t},meteoJS.events=meteoJS.events?meteoJS.events:{},meteoJS.events.on=function(e,t,n){if(!("listeners"in this)||this.listeners===undefined)this.listeners={};e in this.listeners||(this.listeners[e]={});var r=Math.random().toString(36).substr(2,9);return this.listeners[e][r]={callback:t,thisArg:n},r},meteoJS.events.un=function(e,t){"listeners"in this&&this.listeners!==undefined&&e in this.listeners&&t in this.listeners[e]&&delete this.listeners[e][t]},meteoJS.events.once=function(e,t,n){if(!("once_listeners"in this)||this.once_listeners===undefined)this.once_listeners={};if(!(e in this.once_listeners)||!("push"in this.once_listeners[e]))this.once_listeners[e]=[];this.once_listeners[e].push({callback:t,thisArg:n})},meteoJS.events.hasListener=function(e){return"listeners"in this&&this.listeners!==undefined&&e in this.listeners&&Object.keys(this.listeners[e]).length||"once_listeners"in this&&e in this.once_listeners&&Object.keys(this.once_listeners[e]).length},meteoJS.events.trigger=function(e){var t=this,n=Array.prototype.slice.call(arguments);n.shift();if("listeners"in this&&this.listeners!==undefined&&e in this.listeners&&typeof this.listeners[e]=="object"){var t=this;Object.keys(this.listeners[e]).forEach(function(r){t.listeners[e][r].callback.apply(t.listeners[e][r].thisArg===undefined?t:t.listeners[e][r].thisArg,n)})}if("once_listeners"in this&&this.once_listeners!==undefined&&e in this.once_listeners&&"forEach"in this.once_listeners[e]){var r=this.once_listeners[e];this.once_listeners[e]=[],r.forEach(function(e){e.callback.apply(e.thisArg===undefined?t:e.thisArg,n)})}},meteoJS.events.addEventFunctions=function(e){e.on=meteoJS.events.on,e.un=meteoJS.events.un,e.once=meteoJS.events.once,e.hasListener=meteoJS.events.hasListener,e.trigger=meteoJS.events.trigger},meteoJS.sounding=function(e){this.options=$.extend(!0,{calcMissing:!1},e),this.levels={}},meteoJS.sounding.prototype.addLevels=function(e,t){return e.forEach(function(e){this.addLevel(e,t)},this),this},meteoJS.sounding.prototype.addLevel=function(e,t){var n=$.extend(!0,this.options?this.options:{},t?t:{});return"pres"in e&&e.pres!==undefined&&(n!==undefined&&"calcMissing"in n&&n.calcMissing&&(e=this.calculateMissingData(e)),this.levels[e.pres]=e),this},meteoJS.sounding.prototype.calculateMissingData=function(e){return e=$.extend(!0,this.getData(),e),e.hght===undefined&&(e.hght=meteoJS.calc.altitudeISAByPres(e.pres)),e.u===undefined&&e.v===undefined&&e.wdir!==undefined&&e.wspd!==undefined?(e.u=e.wspd*Math.sin(e.wdir/180*Math.PI),e.v=e.wspd*Math.cos(e.wdir/180*Math.PI)):e.u!==undefined&&e.v!==undefined&&e.wdir===undefined&&e.wspd===undefined&&(e.wspd=Math.sqrt(Math.pow(e.u,2)+Math.pow(e.v,2)),e.wdir=Math.arctan(e.u/e.v)/Math.PI*180),e.tmpk!==undefined&&e.dwpk!==undefined?(e.theta===undefined&&(e.theta=meteoJS.calc.potentialTempByTempAndPres(e.tmpk,e.pres)),e.thetae===undefined&&(e.thetae=meteoJS.calc.equiPotentialTempByTempAndDewpointAndPres(e.tmpk,e.dwpk,e.pres))):e.mixr!==undefined&&e.dwpk===undefined&&(e.dwpk=meteoJS.calc.dewpointByHMRAndPres(e.mixr,e.pres)),e},meteoJS.sounding.prototype.removeLevel=function(e){return e in this.levels&&delete this.levels[e],this},meteoJS.sounding.prototype.getData=function(e){return e in this.levels?this.levels[e]:{pres:undefined,hght:undefined,tmpk:undefined,dwpk:undefined,wdir:undefined,wspd:undefined,u:undefined,v:undefined,relh:undefined,mixr:undefined,theta:undefined,thetae:undefined,wetbulb:undefined,vtmp:undefined}},meteoJS.sounding.prototype.getLevels=function(){return Object.keys(this.levels).map(function(e){return+e}).sort(function(e,t){return e-t})},meteoJS.sounding.prototype.getNearestLevel=function(e){return Object.keys(this.levels).length<1?undefined:Object.keys(this.levels).sort(function(t,n){return Math.abs(t-e)-Math.abs(n-e)}).shift()},meteoJS.timeline=function(e){this.options=$.extend(!0,{maxTimeGap:undefined},e),this.selectedTime=new Date("invalid"),this.times=[],this.enabledTimes=[],this.allEnabledTimes=[],this.timesByKey={}},meteoJS.events.addEventFunctions(meteoJS.timeline.prototype),meteoJS.timeline.prototype.getSelectedTime=function(){return this.selectedTime},meteoJS.timeline.prototype.setSelectedTime=function(e){return this._setSelectedTime(meteoJS.timeline._indexOfTimeInTimesArray(e,this.times)>-1?e:new Date("invalid")),this},meteoJS.timeline.prototype.getTimes=function(){return this.times},meteoJS.timeline.prototype.getEnabledTimes=function(){return this.enabledTimes},meteoJS.timeline.prototype.getAllEnabledTimes=function(){return this.allEnabledTimes},meteoJS.timeline.prototype.setTimesBySetID=function(e,t){return this.timesByKey[e]={times:t,enabled:t},this._updateTimes(),this._updateEnabledTimes(),this},meteoJS.timeline.prototype.setEnabledTimesBySetID=function(e,t){return e in this.timesByKey&&(this.timesByKey[e].enabled=t,this._updateEnabledTimes()),this},meteoJS.timeline.prototype.getSetIDs=function(){return Object.keys(this.timesByKey)},meteoJS.timeline.prototype.deleteSetID=function(e){return e in this.timesByKey&&(delete this.timesByKey[e],this._updateTimes(),this._updateEnabledTimes()),this},meteoJS.timeline.prototype.first=function(){return this._setSelectedTime(this.getFirstEnabledTime()),this},meteoJS.timeline.prototype.last=function(){return this._setSelectedTime(this.getLastEnabledTime()),this},meteoJS.timeline.prototype.next=function(){return this._setSelectedTime(this.getNextEnabledTime()),this},meteoJS.timeline.prototype.prev=function(){return this._setSelectedTime(this.getPrevEnabledTime()),this},meteoJS.timeline.prototype.nextAllEnabledTime=function(){return this._setSelectedTime(this.getNextAllEnabledTime()),this},meteoJS.timeline.prototype.prevAllEnabledTime=function(){return this._setSelectedTime(this.getPrevAllEnabledTime()),this},meteoJS.timeline.prototype.add=function(e,t){if(typeof moment!="function")throw new Error("add() needs moment.js");var n=moment(this.getSelectedTime()).add(e,t);return meteoJS.timeline._indexOfTimeInTimesArray(n.toDate(),this.times)>-1&&this._setSelectedTime(n.toDate()),this},meteoJS.timeline.prototype.sub=function(e,t){if(typeof moment!="function")throw new Error("sub() needs moment.js");var n=moment(this.getSelectedTime()).subtract(e,t);return meteoJS.timeline._indexOfTimeInTimesArray(n.toDate(),this.times)>-1&&this._setSelectedTime(n.toDate()),this},meteoJS.timeline.prototype.getFirstEnabledTime=function(){return this.enabledTimes.length>0?this.enabledTimes[0]:new Date("invalid")},meteoJS.timeline.prototype.getLastEnabledTime=function(){return this.enabledTimes.length>0?this.enabledTimes[this.enabledTimes.length-1]:new Date("invalid")},meteoJS.timeline.prototype.getNextEnabledTime=function(){if(this.enabledTimes.length<1)return new Date("invalid");var e=meteoJS.timeline._indexOfTimeInTimesArray(this.getSelectedTime(),this.enabledTimes);if(e>-1)return e++,e<this.enabledTimes.length?this.enabledTimes[e]:this.enabledTimes[this.enabledTimes.length-1];if(isNaN(this.getSelectedTime()))return this.enabledTimes[0];var t=new Date("invalid");for(var n=0;n<this.enabledTimes.length;n++)if(this.getSelectedTime().valueOf()<this.enabledTimes[n].valueOf()){t=this.enabledTimes[n];break}return t},meteoJS.timeline.prototype.getPrevEnabledTime=function(){if(this.enabledTimes.length<1)return new Date("invalid");var e=meteoJS.timeline._indexOfTimeInTimesArray(this.getSelectedTime(),this.enabledTimes);if(e>-1)return e--,-1<e?this.enabledTimes[e]:this.enabledTimes[0];if(isNaN(this.getSelectedTime()))return this.enabledTimes[0];var t=new Date("invalid");for(var n=this.enabledTimes.length-1;n>=0;n--)if(this.getSelectedTime().valueOf()>this.enabledTimes[n].valueOf()){t=this.enabledTimes[n];break}return t},meteoJS.timeline.prototype.getFirstAllEnabledTime=function(){return this.allEnabledTimes.length>0?this.allEnabledTimes[0]:new Date("invalid")},meteoJS.timeline.prototype.getLastAllEnabledTime=function(){return this.allEnabledTimes.length>0?this.allEnabledTimes[this.allEnabledTimes.length-1]:new Date("invalid")},meteoJS.timeline.prototype.getNextAllEnabledTime=function(){if(this.allEnabledTimes.length<1)return new Date("invalid");var e=meteoJS.timeline._indexOfTimeInTimesArray(this.getSelectedTime(),this.allEnabledTimes);if(e>-1)return e++,e<this.allEnabledTimes.length?this.allEnabledTimes[e]:this.allEnabledTimes[this.allEnabledTimes.length-1];if(isNaN(this.getSelectedTime()))return this.allEnabledTimes[0];var t=new Date("invalid");for(var n=0;n<this.allEnabledTimes.length;n++)if(this.getSelectedTime().valueOf()<this.allEnabledTimes[n].valueOf()){t=this.allEnabledTimes[n];break}return t},meteoJS.timeline.prototype.getPrevAllEnabledTime=function(){if(this.allEnabledTimes.length<1)return new Date("invalid");var e=meteoJS.timeline._indexOfTimeInTimesArray(this.getSelectedTime(),this.allEnabledTimes);if(e>-1)return e--,-1<e?this.allEnabledTimes[e]:this.allEnabledTimes[0];if(isNaN(this.getSelectedTime()))return this.allEnabledTimes[0];var t=new Date("invalid");for(var n=this.allEnabledTimes.length-1;n>=0;n--)if(this.getSelectedTime().valueOf()>this.allEnabledTimes[n].valueOf()){t=this.allEnabledTimes[n];break}return t},meteoJS.timeline.prototype.isFirstEnabledTime=function(){return this.getFirstEnabledTime().valueOf()==this.getSelectedTime().valueOf()},meteoJS.timeline.prototype.isLastEnabledTime=function(){return this.getLastEnabledTime().valueOf()==this.getSelectedTime().valueOf()},meteoJS.timeline.prototype._setSelectedTime=function(e){var t=this.selectedTime;return this.selectedTime=e,this.trigger("change:time",t),this.selectedTime},meteoJS.timeline.prototype._updateTimes=function(){this.times=[];var e=[],t={};for(var n in this.timesByKey)this.timesByKey[n].times.forEach(function(n){n.valueOf()in t||(e.push(n),t[n.valueOf()]=n)});this._sortTimesArray(e),e.forEach(function(e,t){if(this.times.length<1){this.times.push(e);return}var n=this.times[this.times.length-1];if(this.options.maxTimeGap!==undefined&&e.valueOf()-n.valueOf()>1e3*this.options.maxTimeGap){var r=n;do r=new Date(r.getTime()+this.options.maxTimeGap*1e3),this.times.push(r);while(e.valueOf()-r.valueOf()>1e3*this.options.maxTimeGap)}this.times.push(e)},this),this._sortTimesArray(this.times),this.trigger("change:times")},meteoJS.timeline.prototype._updateEnabledTimes=function(){this.enabledTimes=[],this.allEnabledTimes=[];var e={},t={};for(var n in this.timesByKey)this.timesByKey[n].enabled.forEach(function(n){n.valueOf()in e||(this.enabledTimes.push(n),e[n.valueOf()]=n),n.valueOf()in t?t[n.valueOf()]++:t[n.valueOf()]=1},this);this._sortTimesArray(this.enabledTimes);for(var r in t)t[r]==Object.keys(this.timesByKey).length&&this.allEnabledTimes.push(e[r]);this._sortTimesArray(this.allEnabledTimes),this.trigger("change:enabledTimes")},meteoJS.timeline._indexOfTimeInTimesArray=function(e,t){return t.findIndex(function(t){return t.valueOf()==e.valueOf()})},meteoJS.timeline.prototype._sortTimesArray=function(e){e.sort(function(e,t){return e.valueOf()-t.valueOf()})},meteoJS.timeline.visualisation={},meteoJS.timeline.visualisation.text=function(e,t){this.timeline=e,this.options=$.extend(!0,{node:undefined,format:undefined},t),this.timeline.on("change:time",function(){this.options.node.text(moment(this.timeline.getSelectedTime()).format(this.options.format))},this),this.timeline.trigger("change:time")},meteoJS.timeline.visualisation.slider=function(e,t){this.timeline=e,this.options=$.extend(!0,{node:undefined},t),this.enabledTimes=[],this.enabledTimesIndexes={},this.options.node.prop("min",1),this.options.node.prop("step",1);var n=this;this.options.node.on("change input",function(){var e=+$(this).val();0<e&&e<=n.enabledTimes.length&&n.timeline.setSelectedTime(n.enabledTimes[e-1])}),this.timeline.on("change:time",function(){var e=this.timeline.getSelectedTime();e.valueOf()in this.enabledTimesIndexes?this.options.node.val(this.enabledTimesIndexes[e.valueOf()]+1):this.options.node.val(1)},this),this.timeline.on("change:enabledTimes",function(){this.enabledTimes=this.timeline.getEnabledTimes(),this.enabledTimesIndexes={},this.enabledTimes.forEach(function(e,t){this.enabledTimesIndexes[e.valueOf()]=t},this),this.options.node.prop("max",this.enabledTimes.length)},this),this.timeline.trigger("change:enabledTimes"),this.timeline.trigger("change:time")},meteoJS.thermodynamicDiagram=function(e){this.options=$.extend(!0,{renderTo:undefined,width:undefined,height:undefined,coordinateSystem:{type:undefined,pressure:{min:undefined,max:undefined},temperature:{min:undefined,max:undefined,reference:undefined}},diagram:{visible:!0,x:undefined,y:undefined,width:undefined,height:undefined,type:undefined,events:{click:function(e,t,n){},mouseOver:function(e,t,n){}}},windprofile:{visible:!0,x:undefined,y:undefined,width:undefined,height:undefined},hodograph:{visible:!0,x:undefined,y:undefined,width:undefined,height:undefined},xAxis:{visible:!0,x:undefined,y:undefined,width:undefined,height:undefined},yAxis:{visible:!0,x:undefined,y:undefined,width:undefined,height:undefined}},e),this.finalizeOptions();var t=$.extend({},this.options.coordinateSystem);t.width=this.options.diagram.width,t.height=this.options.diagram.height,this.coordinateSystem=t.type=="stueve"?new meteoJS.thermodynamicDiagram.coordinateSystem.stueveDiagram(t):t.type=="emagram"?new meteoJS.thermodynamicDiagram.coordinateSystem.emagram(t):new meteoJS.thermodynamicDiagram.coordinateSystem.skewTlogPDiagram(t),this.svg=SVG($(this.options.renderTo)[0]).size(this.options.width,this.options.height),this.diagram=new meteoJS.thermodynamicDiagram.tdDiagram(this,this.options.diagram),this.xAxis=new meteoJS.thermodynamicDiagram.axes.xAxis(this,this.options.xAxis),this.yAxis=new meteoJS.thermodynamicDiagram.axes.yAxis(this,this.options.yAxis),this.windprofile=new meteoJS.thermodynamicDiagram.windprofile(this,this.options.windprofile),this.hodograph=new meteoJS.thermodynamicDiagram.hodograph(this,this.options.hodograph);var n=this;$(this.options.renderTo).mousemove(function(e){var t=$(this).offset(),r=e.pageX-t.left,i=e.pageY-t.top,s=n.diagram.getX(),o=s+n.diagram.getWidth(),u=n.diagram.getY(),a=u+n.diagram.getHeight(),f=r-s,l=i-u;if(0<=f&&f<=n.diagram.getWidth()&&0<=l&&l<=n.diagram.getHeight()){var c=n.getCoordinateSystem();n.options.diagram.events.mouseOver.call(n,e,c.getPByXY(f,n.diagram.getHeight()-l),c.getTByXY(f,n.diagram.getHeight()-l))}}),this.soundings=[]},meteoJS.thermodynamicDiagram.prototype.getSVGNode=function(){return this.svg},meteoJS.thermodynamicDiagram.prototype.getDiagramPlotArea=function(){return this.diagram},meteoJS.thermodynamicDiagram.prototype.getCoordinateSystem=function(){return this.coordinateSystem},meteoJS.thermodynamicDiagram.prototype.finalizeOptions=function(){this.options.width=this.options.width===undefined?$(this.options.renderTo).width():this.options.width,this.options.height=this.options.height===undefined?$(this.options.renderTo).height():this.options.height,this.options.diagram.visible||(this.options.diagram.width=0,this.options.diagram.height=0),this.options.windprofile.visible||(this.options.windprofile.width=0,this.options.windprofile.height=0),this.options.xAxis.visible||(this.options.xAxis.width=0,this.options.xAxis.height=0),this.options.yAxis.visible||(this.options.yAxis.width=0,this.options.yAxis.height=0);var e=this.options.width*.05;this.options.xAxis.width===undefined&&this.options.diagram.width===undefined&&this.options.windprofile.width===undefined?(this.options.xAxis.width=(this.options.width-2*e)*.1,this.options.diagram.width=(this.options.width-2*e)*.7,this.options.windprofile.width=(this.options.width-2*e)*.2):this.options.diagram.width===undefined?this.options.diagram.width=this.options.width-2*e-this.options.windprofile.width:this.options.windprofile.width===undefined&&(this.options.windprofile.width=this.options.width-2*e-this.options.diagram.width);var t=this.options.xAxis.width+this.options.diagram.width+this.options.windprofile.width;this.options.xAxis.x===undefined&&this.options.diagram.x===undefined&&this.options.windprofile.x===undefined?(this.options.xAxis.x=e,this.options.diagram.x=this.options.xAxis.x+this.options.xAxis.width,this.options.windprofile.x=this.options.diagram.x+this.options.diagram.width):this.options.diagram.x===undefined?this.options.diagram.x=this.options.windprofile.x-this.options.windprofile.width:this.options.windprofile.x===undefined&&(this.options.windprofile.x=this.options.diagram.x+this.options.diagram.width),this.options.yAxis.height===undefined&&(this.options.yAxis.height=this.options.height*.06),this.options.diagram.height===undefined&&(this.options.diagram.height=this.options.height-this.options.yAxis.height-2*e),this.options.xAxis.height===undefined&&(this.options.xAxis.height=this.options.diagram.height),this.options.windprofile.height===undefined&&(this.options.windprofile.height=this.options.diagram.height),this.options.diagram.y===undefined&&(this.options.diagram.y=e),this.options.xAxis.y===undefined&&(this.options.xAxis.y=this.options.diagram.y),this.options.windprofile.y===undefined&&(this.options.windprofile.y=this.options.diagram.y),this.options.yAxis.width===undefined&&(this.options.yAxis.width=this.options.diagram.width),this.options.yAxis.x===undefined&&(this.options.yAxis.x=this.options.diagram.x),this.options.yAxis.y===undefined&&(this.options.yAxis.y=this.options.diagram.y+this.options.diagram.height),this.options.yAxis.height===undefined&&(this.options.yAxis.height=e),this.options.coordinateSystem.type===undefined&&(this.options.coordinateSystem.type="skewTlogP"),this.options.coordinateSystem.pressure.min===undefined&&(this.options.coordinateSystem.pressure.min=100),this.options.coordinateSystem.pressure.max===undefined&&(this.options.coordinateSystem.pressure.max=1050),this.options.coordinateSystem.temperature.min===undefined&&(this.options.coordinateSystem.temperature.min=meteoJS.calc.tempCelsiusToKelvin(-40)),this.options.coordinateSystem.temperature.max===undefined&&(this.options.coordinateSystem.temperature.max=meteoJS.calc.tempCelsiusToKelvin(45)),this.options.coordinateSystem.temperature.reference===undefined&&(this.options.coordinateSystem.temperature.reference="base"),this.options.hodograph.x===undefined&&(this.options.hodograph.x=this.options.diagram.x),this.options.hodograph.y===undefined&&(this.options.hodograph.y=this.options.diagram.y),this.options.hodograph.width===undefined&&(this.options.hodograph.width=Math.min(this.options.diagram.width,this.options.diagram.height)*.4),this.options.hodograph.height===undefined&&(this.options.hodograph.height=this.options.hodograph.width)},meteoJS.thermodynamicDiagram.prototype.addSounding=function(e,t){var n=new meteoJS.thermodynamicDiagram.sounding(e,t);return this.soundings.push(n),this.diagram.addSounding(n),this.windprofile.addSounding(n),this.hodograph.addSounding(n),n},meteoJS.thermodynamicDiagram.coordinateSystem=function(e){this.temperatureBottomLeft=undefined,this.temperatureBottomRight=undefined,this.inclinationTan=undefined,this.options=$.extend(!0,{width:100,height:100,pressure:{min:100,max:1e3},temperature:{min:meteoJS.calc.tempCelsiusToKelvin(-40),max:meteoJS.calc.tempCelsiusToKelvin(45),reference:"base",inclinationAngle:45}},e),this._normalizeTemperatureRange()},meteoJS.thermodynamicDiagram.coordinateSystem.prototype.getWidth=function(){return this.options.width},meteoJS.thermodynamicDiagram.coordinateSystem.prototype.getHeight=function(){return this.options.height},meteoJS.thermodynamicDiagram.coordinateSystem.prototype.isIsobarsStraightLine=function(){return!0},meteoJS.thermodynamicDiagram.coordinateSystem.prototype.isDryAdiabatStraightLine=function(){return!1},meteoJS.thermodynamicDiagram.coordinateSystem.prototype.isIsothermsVertical=function(){return this.options.temperature.inclinationAngle!==undefined&&this.options.temperature.inclinationAngle==0},meteoJS.thermodynamicDiagram.coordinateSystem.prototype.getPByXY=function(e,t){return Math.pow(this.options.pressure.min,t/this.getHeight())*Math.pow(this.options.pressure.max,(this.getHeight()-t)/this.getHeight())},meteoJS.thermodynamicDiagram.coordinateSystem.prototype.getTByXY=function(e,t){var n=e-t*this.inclinationTan;return this.temperatureBottomLeft+n*(this.temperatureBottomRight-this.temperatureBottomLeft)/this.getWidth()},meteoJS.thermodynamicDiagram.coordinateSystem.prototype.getYByXP=function(e,t){return this.getHeight()*Math.log(this.options.pressure.max/t)/Math.log(this.options.pressure.max/this.options.pressure.min)},meteoJS.thermodynamicDiagram.coordinateSystem.prototype.getTByXP=function(e,t){return this.getTByXY(e,this.getYByXP(e,t))},meteoJS.thermodynamicDiagram.coordinateSystem.prototype.getXByYT=function(e,t){var n=(t-this.temperatureBottomLeft)*this.getWidth()/(this.temperatureBottomRight-this.temperatureBottomLeft);return n+e*this.inclinationTan},meteoJS.thermodynamicDiagram.coordinateSystem.prototype.getYByXT=function(e,t){return this.inclinationTan!=0?(e-this.getXByYT(0,t))/this.inclinationTan:undefined},meteoJS.thermodynamicDiagram.coordinateSystem.prototype.getXByPT=function(e,t){return this.getXByYT(this.getYByXP(0,e),t)},meteoJS.thermodynamicDiagram.coordinateSystem.prototype.getYByPT=function(e,t){return this.getYByXP(0,e)},meteoJS.thermodynamicDiagram.coordinateSystem.prototype.getXByYPotentialTemperature=function(e,t){var t=meteoJS.calc.tempByPotentialTempAndPres(t,this.getPByXY(0,e));return this.getXByYT(e,t)},meteoJS.thermodynamicDiagram.coordinateSystem.prototype.getYByXPotentialTemperature=function(e,t){var n=this.getPByXY(e,0),r=this.getPByXY(e,this.getHeight());if(meteoJS.calc.potentialTempByTempAndPres(this.getTByXP(e,r),r)<t||t<meteoJS.calc.potentialTempByTempAndPres(this.getTByXP(e,n),n))return undefined;while(n-r>10){var i=r+(n-r)/2,s=this.getTByXP(e,i),o=meteoJS.calc.potentialTempByTempAndPres(s,i);if(o===undefined)return undefined;o<t?n=i:r=i}var u=this.getYByXP(e,r+(n-r)/2);return u},meteoJS.thermodynamicDiagram.coordinateSystem.prototype.getXByPPotentialTemperatur=function(e,t){var t=meteoJS.calc.tempByPotentialTempAndPres(t,e);return this.getXByPT(e,t)},meteoJS.thermodynamicDiagram.coordinateSystem.prototype.getYByPPotentialTemperatur=function(e,t){var n=this.getXByPPotentialTemperatur(e,t);return this.getYByXPotentialTemperature(n,t)},meteoJS.thermodynamicDiagram.coordinateSystem.prototype.getXByYHMR=function(e,t){var n=this.getPByXY(0,e);return this.getXByYT(e,meteoJS.calc.dewpointByHMRAndPres(t,n))},meteoJS.thermodynamicDiagram.coordinateSystem.prototype.getYByXHMR=function(e,t){var n=this.getPByXY(e,0),r=this.getPByXY(e,this.getHeight());while(n-r>10){var i=r+(n-r)/2,s=meteoJS.calc.saturationHMRByTempAndPres(this.getTByXP(e,i),i);if(s===undefined)return undefined;s<t?r=i:n=i}var o=this.getYByXP(e,r+(n-r)/2);return o},meteoJS.thermodynamicDiagram.coordinateSystem.prototype.getXByPHMR=function(e,t){var n=meteoJS.calc.dewpointByHMRAndPres(t,e);return this.getXByPT(e,n)},meteoJS.thermodynamicDiagram.coordinateSystem.prototype.getYByPHMR=function(e,t){var n=meteoJS.calc.dewpointByHMRAndPres(t,e);return this.getYByPT(e,n)},meteoJS.thermodynamicDiagram.coordinateSystem.prototype.getXByYEquiPotTemp=function(e,t){var n=meteoJS.calc.tempByEquiPotTempAndPres(t,this.getPByXY(0,e));return this.getXByYT(e,n)},meteoJS.thermodynamicDiagram.coordinateSystem.prototype.getYByXEquiPotTemp=function(e,t){var n=0,r=this.getHeight();while(r-n>10){var i=n+(r-n)/2,s=this.getYByXT(e,meteoJS.calc.tempByEquiPotTempAndPres(t,this.getPByXY(e,i)));if(s===undefined)return undefined;s<t?r=i:n=i}return i},meteoJS.thermodynamicDiagram.coordinateSystem.prototype.getXByPEquiPotTemp=function(e,t){var n=meteoJS.calc.tempByEquiPotTempAndPres(t,e);return this.getXByPT(e,n)},meteoJS.thermodynamicDiagram.coordinateSystem.prototype.getYByPEquiPotTemp=function(e,t){var n=meteoJS.calc.tempByEquiPotTempAndPres(t,e);return this.getYByPT(e,n)},meteoJS.thermodynamicDiagram.coordinateSystem.prototype._normalizeTemperatureRange=function(){this.temperatureBottomLeft=this.options.temperature.min,this.temperatureBottomRight=this.options.temperature.max,this.inclinationTan=this.options.temperature.inclinationAngle==45?1:this.options.temperature.inclinationAngle==0?0:Math.tan(this.options.temperature.inclinationAngle*Math.PI/180);if(/^[0-9]+$/.test(this.options.temperature.reference)){var e=this.getYByXP(0,this.options.temperature.reference),t=this.inclinationTan*e,n=(this.temperatureBottomRight-this.temperatureBottomLeft)/this.getWidth();this.temperatureBottomLeft+=n*t,this.temperatureBottomRight+=n*t}},meteoJS.thermodynamicDiagram.coordinateSystem.skewTlogPDiagram=function(e){meteoJS.thermodynamicDiagram.coordinateSystem.call(this,e)},meteoJS.thermodynamicDiagram.coordinateSystem.skewTlogPDiagram.prototype=Object.create(meteoJS.thermodynamicDiagram.coordinateSystem.prototype),meteoJS.thermodynamicDiagram.coordinateSystem.skewTlogPDiagram.prototype.constructor=meteoJS.thermodynamicDiagram.coordinateSystem.skewTlogPDiagram,meteoJS.thermodynamicDiagram.coordinateSystem.emagram=function(e){"temperature"in e||(e.temperature={}),e.temperature.inclinationAngle=0,meteoJS.thermodynamicDiagram.coordinateSystem.call(this,e)},meteoJS.thermodynamicDiagram.coordinateSystem.emagram.prototype=Object.create(meteoJS.thermodynamicDiagram.coordinateSystem.prototype),meteoJS.thermodynamicDiagram.coordinateSystem.emagram.prototype.constructor=meteoJS.thermodynamicDiagram.coordinateSystem.emagram,meteoJS.thermodynamicDiagram.coordinateSystem.stueveDiagram=function(e){this.k=.2857,"temperature"in e||(e.temperature={}),e.temperature.inclinationAngle=0,meteoJS.thermodynamicDiagram.coordinateSystem.call(this,e)},meteoJS.thermodynamicDiagram.coordinateSystem.stueveDiagram.prototype=Object.create(meteoJS.thermodynamicDiagram.coordinateSystem.prototype),meteoJS.thermodynamicDiagram.coordinateSystem.stueveDiagram.prototype.constructor=meteoJS.thermodynamicDiagram.coordinateSystem.stueveDiagram,meteoJS.thermodynamicDiagram.coordinateSystem.stueveDiagram.prototype.isDryAdiabatStraightLine=function(){return!0},meteoJS.thermodynamicDiagram.coordinateSystem.stueveDiagram.prototype.getPByXY=function(e,t){return Math.pow(Math.pow(this.options.pressure.max,this.k)-t*(Math.pow(this.options.pressure.max,this.k)-Math.pow(this.options.pressure.min,this.k))/this.getHeight(),1/this.k)},meteoJS.thermodynamicDiagram.coordinateSystem.stueveDiagram.prototype.getYByXP=function(e,t){return this.getHeight()*(Math.pow(this.options.pressure.max,this.k)-Math.pow(t,this.k))/(Math.pow(this.options.pressure.max,this.k)-Math.pow(this.options.pressure.min,this.k))},meteoJS.thermodynamicDiagram.coordinateSystem.stueveDiagram.prototype.getYByXT=function(e,t){return undefined},meteoJS.thermodynamicDiagram.sounding=function(e,t){this.sounding=e,this.options=$.extend(!0,{visible:!0,diagram:{visible:!0,temp:{visible:!0,style:{color:undefined,width:1,opacity:undefined,linecap:undefined,linejoin:undefined,dasharray:undefined}},dewp:{visible:!0,style:{color:undefined,width:1,opacity:undefined,linecap:undefined,linejoin:undefined,dasharray:undefined}}},windprofile:{visible:!0,windbarbs:{visible:!0,style:{color:undefined,width:1,opacity:undefined,linecap:undefined,linejoin
:undefined,dasharray:undefined}},windspeed:{visible:!0,style:{color:undefined,width:1,opacity:undefined,linecap:undefined,linejoin:undefined,dasharray:undefined}}},hodograph:{visible:!0,style:{width:1}}},t)},meteoJS.events.addEventFunctions(meteoJS.thermodynamicDiagram.sounding.prototype),meteoJS.thermodynamicDiagram.sounding.prototype.getSounding=function(){return this.sounding},meteoJS.thermodynamicDiagram.sounding.prototype.visible=function(e){if(e===undefined)return this.options.visible;var t=this.options.visible;return this.options.visible=e?!0:!1,t!=this.options.visible&&this.trigger("change:visible",this),this},meteoJS.thermodynamicDiagram.tdDiagram=function(e,t){this.options=$.extend(!0,{visible:!0,x:undefined,y:undefined,width:undefined,height:undefined,isobars:{highlightedLines:undefined,interval:undefined,lines:undefined,max:undefined,min:undefined,style:{color:undefined,width:1,opacity:undefined,linecap:undefined,linejoin:undefined,dasharray:undefined},visible:!0},isotherms:{highlightedLines:[meteoJS.calc.tempCelsiusToKelvin(0)],interval:undefined,lines:undefined,max:undefined,min:undefined,style:{color:undefined,width:1,opacity:undefined,linecap:undefined,linejoin:undefined,dasharray:undefined},visible:!0},dryadiabats:{highlightedLines:undefined,interval:undefined,lines:undefined,max:undefined,min:undefined,style:{color:"green",width:1,opacity:undefined,linecap:undefined,linejoin:undefined,dasharray:undefined},visible:!0},pseudoadiabats:{highlightedLines:undefined,interval:undefined,lines:undefined,max:undefined,min:undefined,style:{color:"blue",width:1,opacity:undefined,linecap:undefined,linejoin:undefined,dasharray:undefined},visible:!0},mixingratio:{highlightedLines:undefined,interval:undefined,lines:undefined,max:undefined,min:undefined,style:{color:"red",width:1,opacity:undefined,linecap:undefined,linejoin:undefined,dasharray:undefined},visible:!0}},t),this.main=e,this.cos=e.getCoordinateSystem();var n=e.getSVGNode().nested().attr({x:this.options.x,y:this.options.y,width:this.cos.getWidth(),height:this.cos.getHeight()}).style({overflow:"hidden"});this.svgGroups={border:n.group(),isobars:n.group(),isotherms:n.group(),dryadiabats:n.group(),mixingratio:n.group(),pseudoadiabats:n.group(),soundings:n.group()},this.plotGuideLines()},meteoJS.thermodynamicDiagram.tdDiagram.prototype.getX=function(){return this.options.x},meteoJS.thermodynamicDiagram.tdDiagram.prototype.getY=function(){return this.options.y},meteoJS.thermodynamicDiagram.tdDiagram.prototype.getWidth=function(){return this.cos.getWidth()},meteoJS.thermodynamicDiagram.tdDiagram.prototype.getHeight=function(){return this.cos.getHeight()},meteoJS.thermodynamicDiagram.tdDiagram.prototype.getIsobarsVisible=function(){return this.options.isobars.visible},meteoJS.thermodynamicDiagram.tdDiagram.prototype.setIsobarsVisible=function(e){return this.options.isobars.visible=e?!0:!1,this.plotIsobars(),this},meteoJS.thermodynamicDiagram.tdDiagram.prototype.getIsothermsVisible=function(){return this.options.isotherms.visible},meteoJS.thermodynamicDiagram.tdDiagram.prototype.setIsothermsVisible=function(e){return this.options.isotherms.visible=e?!0:!1,this.plotIsotherms(),this},meteoJS.thermodynamicDiagram.tdDiagram.prototype.getDryadiabatsVisible=function(){return this.options.dryadiabats.visible},meteoJS.thermodynamicDiagram.tdDiagram.prototype.setDryadiabatsVisible=function(e){return this.options.dryadiabats.visible=e?!0:!1,this.plotDryadiabats(),this},meteoJS.thermodynamicDiagram.tdDiagram.prototype.getPseudoadiabatsVisible=function(){return this.options.pseudoadiabats.visible},meteoJS.thermodynamicDiagram.tdDiagram.prototype.setPseudoadiabatsVisible=function(e){return this.options.pseudoadiabats.visible=e?!0:!1,this.plotPseudoadiabats(),this},meteoJS.thermodynamicDiagram.tdDiagram.prototype.getMixingratioVisible=function(){return this.options.mixingratio.visible},meteoJS.thermodynamicDiagram.tdDiagram.prototype.setMixingratioVisible=function(e){return this.options.mixingratio.visible=e?!0:!1,this.plotMixingratio(),this},meteoJS.thermodynamicDiagram.tdDiagram.prototype.plotGuideLines=function(){Object.keys(this.svgGroups).forEach(function(e){if(e=="soundings")return;this.svgGroups[e].clear()},this),this.svgGroups.border.clear();var e=this.svgGroups.border.rect(this.cos.getWidth(),this.cos.getHeight()).attr({stroke:"black","stroke-width":1,"fill-opacity":0});this.plotIsobars(!0),this.plotIsotherms(!0),this.plotDryadiabats(!0),this.plotPseudoadiabats(!0),this.plotMixingratio(!0)},meteoJS.thermodynamicDiagram.tdDiagram.prototype.plotIsobars=function(e){var t=this.cos.getPByXY(0,this.cos.getHeight()),n=this.cos.getPByXY(0,0),r=n-t;this._plotLines(this.svgGroups.isobars,this.options.isobars,{min:t,max:n,interval:r>500?50:r>50?10:1},function(e){var t=this.cos.getYByXP(0,e);return[[0,t],[this.cos.getWidth(),t]]},e)},meteoJS.thermodynamicDiagram.tdDiagram.prototype.plotIsotherms=function(e){var t=meteoJS.calc.tempKelvinToCelsius(this.cos.getTByXY(0,this.cos.getHeight())),n=meteoJS.calc.tempKelvinToCelsius(this.cos.getTByXY(this.cos.getWidth(),0)),r=n-t;this._plotLines(this.svgGroups.isotherms,this.options.isotherms,{min:t,max:n,interval:r>50?5:1},function(e){e=meteoJS.calc.tempCelsiusToKelvin(e);var t=[[undefined,undefined],[undefined,undefined]];return this.cos.isIsothermsVertical()?(t[0][1]=0,t[1][1]=this.cos.getHeight(),t[0][0]=t[1][0]=this.cos.getXByYT(t[0][1],e)):(t[0][1]=0,t[0][0]=this.cos.getXByYT(t[0][1],e),t[0][0]<0&&(t[0][1]=this.cos.getYByXT(t[0][0]=0,e)),t[1][0]=this.cos.getWidth(),t[1][1]=this.cos.getYByXT(t[1][0],e),t[1][1]===undefined?(t[1][0]=t[0][0],t[1][1]=this.cos.getHeight()):t[1][1]>this.cos.getHeight()&&(t[1][1]=this.cos.getHeight(),t[1][0]=this.cos.getXByYT(t[1][1],e))),t},e)},meteoJS.thermodynamicDiagram.tdDiagram.prototype.plotDryadiabats=function(e){this._plotLines(this.svgGroups.dryadiabats,this.options.dryadiabats,{min:meteoJS.calc.tempKelvinToCelsius(meteoJS.calc.potentialTempByTempAndPres(this.cos.getTByXY(0,0),this.cos.getPByXY(0,0))),max:meteoJS.calc.tempKelvinToCelsius(meteoJS.calc.potentialTempByTempAndPres(this.cos.getTByXY(this.cos.getWidth(),this.cos.getHeight()),this.cos.getPByXY(this.cos.getWidth(),this.cos.getHeight()))),interval:10},function(e){var t=meteoJS.calc.tempCelsiusToKelvin(e),n=0,r=this.cos.getXByYPotentialTemperature(n,t);if(r===undefined||r>this.cos.getWidth())r=this.cos.getWidth(),n=this.cos.getYByXPotentialTemperature(r,t);var i=0,s=this.cos.getYByXPotentialTemperature(i,t);if(s===undefined||s>this.cos.getHeight())s=this.cos.getHeight(),i=this.cos.getXByYPotentialTemperature(s,t);if(r===undefined||n===undefined||i===undefined||s===undefined)return undefined;if(this.cos.isDryAdiabatStraightLine())return[[r,n],[i,s]];var o=[[r,n]],u=10;for(var a=n+u;a<s;a+=u)o.push([this.cos.getXByYPotentialTemperature(a,t),a]);return o.push([i,s]),o},e)},meteoJS.thermodynamicDiagram.tdDiagram.prototype.plotPseudoadiabats=function(e){this._plotLines(this.svgGroups.pseudoadiabats,this.options.pseudoadiabats,{lines:[-18,-5,10,30,60,110,180]},function(e){var t=meteoJS.calc.tempCelsiusToKelvin(e),n=0,r=this.cos.getXByYEquiPotTemp(n,t),i=this.cos.getHeight(),s=this.cos.getXByYEquiPotTemp(i,t),o=[[r,n]],u=10;for(var a=n+u;a<i;a+=u)o.push([this.cos.getXByYEquiPotTemp(a,t),a]);return o.push([s,i]),o},e)},meteoJS.thermodynamicDiagram.tdDiagram.prototype.plotMixingratio=function(e){this._plotLines(this.svgGroups.mixingratio,this.options.mixingratio,{lines:[.01,.1,1,2,4,7,10,16,21,32,40]},function(e){var t=0,n=this.cos.getXByYHMR(t,e),r=this.cos.getHeight(),i=this.cos.getXByYHMR(r,e),s=[[n,t]],o=10;for(var u=t+o;u<r;u+=o)s.push([this.cos.getXByYHMR(u,e),u]);return s.push([i,r]),s},e)},meteoJS.thermodynamicDiagram.tdDiagram.prototype._plotLines=function(e,t,n,r,i){e.style("display",t.visible?"inline":"none");if(!i)return;e.clear();var s=[];if(t.lines!==undefined)s=t.lines;else if(t.min===undefined&&t.max===undefined&&t.interval===undefined&&n.lines!==undefined)s=n.lines;else{t.min!==undefined&&(n.min=t.min),t.max!==undefined&&(n.max=t.max);var o=t.interval;o===undefined&&(o=n.interval);var u=Math.ceil(n.min/o)*o,a=Math.floor(n.max/o)*o;for(var f=u;f<=a;f+=o)s.push(f)}var l=3;t.style.width!==undefined&&(l=t.style.width+2),s.forEach(function(n){var i=r.call(this,n),s=i.length==2?e.line(i[0][0],this.cos.getHeight()-i[0][1],i[1][0],this.cos.getHeight()-i[1][1]).stroke(t.style):e.polyline(i.map(function(e){return e[1]=this.cos.getHeight()-e[1],e},this)).fill("none").stroke(t.style);t.highlightedLines!==undefined&&t.highlightedLines.forEach(function(e){n==e&&s.stroke({width:l})},this)},this)},meteoJS.thermodynamicDiagram.tdDiagram.prototype.addSounding=function(e){var t=this.svgGroups.soundings.group();e.on("change:visible",function(){t.style("display",this.visible()?"inline":"none")}),e.trigger("change:visible");var n=[],r=[];e.getSounding().getLevels().forEach(function(t){if(t===undefined)return;var i=e.getSounding().getData(t);if(i.tmpk===undefined)return;n.length==0&&n.push([]),n[n.length-1].push([this.cos.getXByPT(t,i.tmpk),this.cos.getHeight()-this.cos.getYByPT(t,i.tmpk)]),r.length==0&&r.push([]),r[r.length-1].push([this.cos.getXByPT(t,i.dwpk),this.cos.getHeight()-this.cos.getYByPT(t,i.dwpk)])},this),n.forEach(function(n){t.polyline(n).fill("none").stroke(e.options.diagram.temp.style)},this),r.forEach(function(n){t.polyline(n).fill("none").stroke(e.options.diagram.dewp.style)},this)},meteoJS.thermodynamicDiagram.windprofile=function(e,t){this.options=$.extend(!0,{visible:!0,x:undefined,y:undefined,width:undefined,height:undefined,windbarbs:{visible:!0,width:undefined,barbsLength:undefined},windspeed:{visible:!0,width:undefined}},t),this.main=e,this.cos=e.getCoordinateSystem(),this.options.windbarbs.visible||(this.options.windbarbs.width=0),this.options.windspeed.visible||(this.options.windspeed.width=0),this.options.windbarbs.width===undefined&&this.options.windspeed.width===undefined?(this.options.windbarbs.width=this.options.width/3,this.options.windspeed.width=this.options.width-this.options.windbarbs.width):this.options.windbarbs.width===undefined?this.options.windbarbs.width=this.options.width-this.options.windspeed.width:this.options.windspeed.width=this.options.width-this.options.windbarbs.width,this.options.windbarbs.barbsLength===undefined&&(this.options.windbarbs.barbsLength=this.options.windbarbs.width*2/5),this.svgNode=e.getSVGNode().nested().attr({x:this.options.x,y:this.options.y,width:this.options.width,height:this.options.height}).style({overflow:"hidden"}),this.nodeWindbarbs=this.svgNode.nested().attr({x:0,y:0,width:this.options.windbarbs.width,height:this.options.height}),this.soundingsWindbarbsGroup=this.nodeWindbarbs.group(),this.options.windbarbs.visible||this.nodeWindbarbs.hide(),this.nodeWindspeed=this.svgNode.nested().attr({x:this.options.windbarbs.width,y:0,width:this.options.windspeed.width,height:this.options.height}),this.options.windspeed.visible||this.nodeWindspeed.hide(),this.plotWindspeeds()},meteoJS.thermodynamicDiagram.windprofile.prototype.plotWindspeeds=function(){this.nodeWindspeed.clear(),this.options.windspeed.visible&&(this.nodeWindspeed.line(0,0,0,this.options.height).stroke({width:1}),this.nodeWindspeed.line(this.options.windspeed.width,0,this.options.windspeed.width,this.options.height).stroke({width:1})),this.soundingsWindspeedGroup=this.nodeWindspeed.group()},meteoJS.thermodynamicDiagram.windprofile.prototype.addSounding=function(e){e.on("change:visible",function(e){this.drawSoundings()},this),this.drawSoundings()},meteoJS.thermodynamicDiagram.windprofile.prototype.drawSoundings=function(){this.soundingsWindbarbsGroup.clear(),this.soundingsWindspeedGroup.clear(),this.main.soundings.forEach(function(e){if(!e.visible()||!e.options.windprofile.visible)return;var t=[],n=[];e.getSounding().getLevels().forEach(function(r){var i=e.getSounding().getData(r);if(i.wspd===undefined||i.wdir===undefined)return;var s=this.options.height-this.cos.getYByXP(0,r);t.push([s,meteoJS.calc.windspeedMSToKN(i.wspd),i.wdir]),n.length==0&&n.push([]),n[n.length-1].push([meteoJS.calc.windspeedMSToKN(this.options.windspeed.width*i.wspd)/150,s])},this),t.forEach(function(t){var n=this.soundingsWindbarbsGroup.group(),r=this.options.windbarbs.width/2,i=t[0]-this.options.windbarbs.barbsLength,s=this.options.windbarbs.barbsLength/4;n.line(r,i,r,t[0]).stroke(e.options.windprofile.windbarbs.style);var o=t[1];while(o>=50)n.polyline([[r,i],[r+s*2,i+s*.8/2],[r,i+s*.8]]).fill("none").stroke(e.options.windprofile.windbarbs.style),i+=s,o-=50;while(o>=10)n.line(r,i+s/2,r+s*2,i).stroke(e.options.windprofile.windbarbs.style),i+=s/2,o-=10;o>=5&&n.line(r,i+s/2,r+s,i+s/4).stroke(e.options.windprofile.windbarbs.style),n.transform({rotation:t[2],cx:r,cy:t[0]})},this),n.forEach(function(t){this.soundingsWindspeedGroup.polyline(t).fill("none").stroke(e.options.windprofile.windspeed.style)},this)},this)},meteoJS.thermodynamicDiagram.hodograph=function(e,t){this.options=$.extend(!0,{visible:!0,x:undefined,y:undefined,width:undefined,height:undefined,grid:{axes:{style:{width:1},visible:!0},circles:{interval:meteoJS.calc.windspeedKMHToMS(50),style:{color:"black",width:1},visible:!0},labels:{angle:225,style:{size:10},visible:!0},max:undefined},windspeedMax:meteoJS.calc.windspeedKNToMS(150),origin:undefined},t),this.main=e,this.cos=e.getCoordinateSystem(),this.svgNode=e.getSVGNode().nested().attr({x:this.options.x,y:this.options.y,width:this.options.width,height:this.options.height}).style({overflow:"hidden"}),this.svgNodeGrid=this.svgNode.group(),this.svgNodeData=this.svgNode.group(),this.minLength=Math.min(this.options.width,this.options.height),this.center=[this.options.width/2,this.options.height/2],this.options.origin!==undefined&&(this.center[0]-=this.options.origin[0]*this.minLength/2,this.center[1]+=this.options.origin[1]*this.minLength/2),this.pixelPerSpeed=Math.min(Math.max(this.options.width-this.center[0],this.center[0]),Math.max(this.options.height-this.center[1],this.center[1]))/this.options.windspeedMax,this.options.grid.max===undefined&&(this.options.grid.max=this.options.windspeedMax),this.plotGrid()},meteoJS.thermodynamicDiagram.hodograph.prototype.plotGrid=function(){this.svgNodeGrid.clear();if(!this.options.visible)return;this.svgNodeGrid.rect(this.options.width-2,this.options.height-2).move(1,1).fill({color:"white"}).stroke({color:"black",width:1});if(this.options.grid.axes.visible){var e=this.options.grid.max+this.options.grid.circles.interval/2;this.svgNodeGrid.line(Math.max(0,this.center[0]-e*this.pixelPerSpeed),this.center[1],Math.min(this.options.width,this.center[0]+e*this.pixelPerSpeed),this.center[1]).stroke(this.options.grid.axes.style),this.svgNodeGrid.line(this.center[0],Math.max(0,this.center[1]-e*this.pixelPerSpeed),this.center[0],Math.min(this.options.height,this.center[1]+e*this.pixelPerSpeed)).stroke(this.options.grid.axes.style)}for(var t=this.options.grid.circles.interval;t<=this.options.grid.max;t+=this.options.grid.circles.interval){var n=t*this.pixelPerSpeed;this.svgNodeGrid.circle(2*n).attr({cx:this.center[0],cy:this.center[1]}).fill("none").stroke(this.options.grid.circles.style);if(this.options.grid.labels.visible){var r=n*Math.cos((this.options.grid.labels.angle-90)/180*Math.PI),i=n*Math.sin((this.options.grid.labels.angle-90)/180*Math.PI),s="middle",o=0,u=-this.options.grid.labels.style.size;if(this.options.grid.labels.angle==0||this.options.grid.labels.angle==180)o=-3,s="end";else if(this.options.grid.labels.angle==90||this.options.grid.labels.angle==270)u=-3;var a=this.svgNodeGrid.plain(Math.round(meteoJS.calc.windspeedMSToKMH(t))).move(this.center[0]+r,this.center[1]+i).attr({"text-anchor":s,dx:o,dy:u}).font(this.options.grid.labels.style),f=a.bbox();a.before(this.svgNodeGrid.rect(f.width,f.height).move(f.x,f.y).fill("white"))}}},meteoJS.thermodynamicDiagram.hodograph.prototype.addSounding=function(e){var t=this.svgNodeData.group(),n=function(){t.style("display",this.visible()?"inline":"none")};e.on("change:visible",n),n.call(e);var r=[];e.getSounding().getLevels().forEach(function(t){if(t===undefined)return;var n=e.getSounding().getData(t);if(n.wdir===undefined||n.wspd===undefined)return;var i=n.wspd*-Math.sin(n.wdir/180*Math.PI),s=n.wspd*Math.cos(n.wdir/180*Math.PI);r.push([this.center[0]+i*this.pixelPerSpeed,this.center[1]+s*this.pixelPerSpeed])},this),t.polyline(r).fill("none").stroke(e.options.hodograph.style)},meteoJS.thermodynamicDiagram.axes={},meteoJS.thermodynamicDiagram.axes.xAxis=function(e,t){this.options=$.extend(!0,{visible:!0,x:undefined,y:undefined,width:undefined,height:undefined,labels:{enabled:!0,style:{color:undefined}},title:{align:"middle",style:{color:undefined},text:undefined}},t),this.cos=e.getCoordinateSystem(),this.svgNode=e.getSVGNode().nested().attr({x:this.options.x,y:this.options.y,width:this.options.width,height:this.options.height}).style({overflow:"hidden"}),this.plotAxes()},meteoJS.thermodynamicDiagram.axes.xAxis.prototype.getX=function(){return this.options.x},meteoJS.thermodynamicDiagram.axes.xAxis.prototype.getY=function(){return this.options.y},meteoJS.thermodynamicDiagram.axes.xAxis.prototype.getWidth=function(){return this.options.width},meteoJS.thermodynamicDiagram.axes.xAxis.prototype.getHeight=function(){return this.options.height},meteoJS.thermodynamicDiagram.axes.xAxis.prototype.plotAxes=function(){this.svgNode.clear();if(this.options.visible){if(this.options.labels.enabled){var e=this.svgNode.group(),t=50,n=Math.ceil(this.cos.getPByXY(0,this.options.height)/t)*t,r=Math.floor(this.cos.getPByXY(0,0)/t)*t,i=11;for(var s=n;s<=r;s+=t){var o=this.options.height-this.cos.getYByXP(0,s),u=e.plain(s).attr({y:o+i*.3,x:this.options.width});u.font({size:i+"px",anchor:"end"}).attr({fill:this.options.labels.style.color})}}if(this.options.title.text!==undefined){var a=this.svgNode.group(),i=12;a.plain(this.options.title.text).attr({x:i*.4,y:this.options.height/2,fill:this.options.title.style.color}).font({size:i,anchor:"middle"}).rotate(-90)}}},meteoJS.thermodynamicDiagram.axes.yAxis=function(e,t){this.options=$.extend(!0,{visible:!0,x:undefined,y:undefined,width:undefined,height:undefined,labels:{enabled:!0,style:{color:undefined}},title:{align:"middle",style:{color:undefined},text:undefined}},t),this.cos=e.getCoordinateSystem(),this.svgNode=e.getSVGNode().nested().attr({x:this.options.x,y:this.options.y,width:this.options.width,height:this.options.height}).style({overflow:"hidden"}),this.plotAxes()},meteoJS.thermodynamicDiagram.axes.yAxis.prototype.getX=function(){return this.options.x},meteoJS.thermodynamicDiagram.axes.yAxis.prototype.getY=function(){return this.options.y},meteoJS.thermodynamicDiagram.axes.yAxis.prototype.getWidth=function(){return this.options.width},meteoJS.thermodynamicDiagram.axes.yAxis.prototype.getHeight=function(){return this.options.height},meteoJS.thermodynamicDiagram.axes.yAxis.prototype.plotAxes=function(){this.svgNode.clear();if(this.options.visible){if(this.options.labels.enabled){var e=this.svgNode.group(),t=10,n=Math.ceil(meteoJS.calc.tempKelvinToCelsius(this.cos.getTByXY(0,0))/t)*t,r=Math.floor(meteoJS.calc.tempKelvinToCelsius(this.cos.getTByXY(this.options.width,0))/t)*t,i=10;for(var s=n;s<=r;s+=t){var o=meteoJS.calc.tempCelsiusToKelvin(s);e.plain(Math.round(meteoJS.calc.tempKelvinToCelsius(o))).attr({x:this.cos.getXByYT(0,o),y:i,fill:this.options.labels.style.color}).font({size:i+"px",anchor:"middle"})}}if(this.options.title.text!==undefined){var u=this.svgNode.group(),i=12;u.plain(this.options.title.text).attr({x:this.options.width/2,y:this.options.height-i*.3,fill:this.options.title.style.color}).font({size:i,anchor:"middle"})}}};